<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AXEvent: axevent.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="axis-logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AXEvent
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('axevent_8h.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">axevent.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>This is the main include file to be used for all applications that want to use the AXEvent library.  
<a href="#details">More...</a></p>

<p><a href="axevent_8h_source.html">Go to the source code of this file.</a></p>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This is the main include file to be used for all applications that want to use the AXEvent library. </p>
<h1><a class="anchor" id="ax_event_purpose"></a>
Purpose</h1>
<p>The axevent library provides an interface to the event system found in Axis devices.</p>
<p>The purpose of the AXEvents library is to provide applications with a mechanism for sending and receiving events. There are two different roles an application can assume when interacting with the event system.</p>
<ul>
<li>A Producer - The application sends events.</li>
<li>A Consumer - The application receives events.</li>
</ul>
<p>An application may assume one or both roles simultaneously.</p>
<h1><a class="anchor" id="ax_event_important"></a>
Important</h1>
<p>The axevent library is designed to be used with the GLib library. An application using the axevent library must have a running GMainLoop.</p>
<h1><a class="anchor" id="ax_event_handler_producers_and_consumers"></a>
Producers and Consumers</h1>
<p>As in event system, event producers declare and send events while event event consumers subscribe to and consume events. The axevent library provides a loose coupling between producers and consumers. This loose coupling allows producers to send events that no one is subscribing to and allows consumers to subscribe to events that no producer has declared or is sending. Of course it would be pointless for a consumer to subscribe to an event that can never be sent, but it may well be interesting to subscribe to an event that may be sent in the future depending on whether a specific product feature is switched on or of. Eg. an event consumer may want to subscribe to motion detection events and is free to do so even when motion detection isn't enabled. When motion detection is enabled, any motion detection event sent will automatically be delivered to the consumer without the consumer having to reinitialize its subscription.</p>
<h2><a class="anchor" id="ax_event_handler_event_aspects"></a>
The three aspects of events</h2>
<p>The axevent library operates on three different aspects of events</p>
<ul>
<li><b>events</b> </li>
<li><b>declarations</b> </li>
<li><b>subscriptions</b> </li>
</ul>
<h2><a class="anchor" id="ax_event_handler_events"></a>
Events</h2>
<p>An event is an instance of an event declaration (see below) and may not contain any unset values. Events with unset values are invalid and are undeliverable. The event's type must be declared before the producer can send the event, see <a class="el" href="axevent_8h.html#ax_event_handler_event_declarations">Event declarations</a> below. An undeclared event is undeliverable. Each event contains a <a class="el" href="ax__event__key__value__set_8h.html#ax_event_key_value_set_key_value_set">AXEventKeyValueSet</a> key/value set and a settable timestamp. The key/value set describes the keys and values that constitute the event. The timestamp will be interpreted by the consumer as the time at which the event occured.</p>
<p>All events are expressed as a set of key/value pairs, where the key should be assigned to a namespace. For example, the event describing that the first I/O port is active is described by the following key/value pairs.</p>
<pre class="fragment">   tns1:topic0=Device
tnsaxis:topic1=IO
tnsaxis:topic2=Port
          port=0
         state=1
</pre><p>Where</p><ul>
<li><b>tns1:</b> is a name space.</li>
<li><b>topic0:</b> is a key.</li>
<li><b>Device:</b> is a value.</li>
</ul>
<p>The general form of a key/value pair can be described as</p>
<pre class="fragment">[name space:]&lt;key&gt;=&lt;value&gt;
</pre><p>The namespace's primary purpose is to avoid name clashes but is also used to distinguish between events declared by different vendors. Each vendor should define their own namespace. In the I/O port example, the namespace <code>tns1</code> is defined by Onvif and <code>tnxaxis</code> is defined by Axis. The keys "port" and "state" are not assigned to a namespace.</p>
<p>Events are managed by the AXEvents type and its associated functions located in <a class="el" href="ax__event_8h.html" title="The AXEvent and its associated functions. ">ax_event.h</a>.</p>
<h2><a class="anchor" id="ax_event_handler_event_declarations"></a>
Event declarations</h2>
<p>An event declaration specifies the <a class="el" href="ax__event__key__value__set_8h.html#ax_event_key_value_set_key_value_set">AXEventKeyValueSet</a> key/value set that contains all the keys that constitute the event. The axevent library provides two kinds of events:</p>
<ul>
<li><em>state</em> less <em>events</em> </li>
<li><em>property</em> <em>states</em> </li>
</ul>
<p><b>Stateless</b> <b>events</b> are events that do not have any persistent state. A stateless event is similar to a signal or a pulse; it has no state and exists only when it is sent. A stateless event can for example be "a point crossed a
   line".</p>
<p>When declaring a stateless event, the producer must specify all keys that consitute the event. If a key has a fixed value, the value must be specified. If a key has variable values, the value should be set to <code>NULL</code> in the declaration.</p>
<p>The example in the link below shows how to declare a stateless event with the following key/value set</p>
<pre class="fragment">tnsaxis:topic0=CameraApplicationPlatform
tnsaxis:topic1=MyApplication
         event=* &lt;-- "event" key has a variable value
</pre><p><a class="el" href="ax_event_stateless_declaration_example_8c-example.html">ax_event_stateless_declaration_example.c</a></p>
<p><b>Property</b> <b>states</b>, or stateful events, are events that have a persistent state. The event is always in one of its states. A property state can for example be the state of an I/O port: active or inactive.</p>
<p>When declaring a property state, the producer must specify all keys that consitute the event. If a key has a fixed value, the value must be specified. If a key has variable values, the value in the declaration should be set to the initial value.</p>
<p>The example in the link below shows hos to declare a property state with the following key/value set</p>
<pre class="fragment">tnsaxis:topic0=CameraApplicationPaltform
tnsaxis:topic1=MyApplication
       feature=myfeature
       enabled=* &lt;-- "enabled" key has a variable value
</pre><p><a class="el" href="ax_event_property_state_declaration_example_8c-example.html">ax_event_property_state_declaration_example.c</a></p>
<h2><a class="anchor" id="ax_event_handler_source_and_data_keys"></a>
Source keys and Data keys</h2>
<p>Event declarations describing events that can be emitted from different sources should contain a <b>source</b> <b>key</b>. The source key is used to identify the source. In the I/O event example above, source key is the <code>port</code> key.</p>
<p>All event declarations should contain a <b>data</b> <b>key</b> that describe the state of the source emitting the event. In the I/O event example above, the data key is the <code>state</code> key.</p>
<p>The source key can be omitted, for example if source information is of no use for the consumer. The data key can also be omitted, although most event will have data of some kind. See ax_event_handler_declare_event for a detailed description about how to declare an event.</p>
<h2><a class="anchor" id="ax_event_handler_declaration_templates"></a>
Event declaration templates</h2>
<p>The recommended method to declare events is to use event declaration templates. An event declaration template is an XML representation of the declaration's key/value set. The template is then referenced when declaring a new event.</p>
<dl class="section user"><dt>Event declaration template schema</dt><dd><pre class="fragment">&lt;?xml version="1.0" encoding="UTF-8"?&gt;

&lt;xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema" elementFromDefault="qualified" attributeFormDefault="unqualified"&gt;

  &lt;xs:complexType name="KeyType"&gt;
    &lt;xs:simpleContent&gt;
      &lt;xs:extension base="xs:string"&gt;
        &lt;xs:attribute name="NameSpace" type="xs:string" /&gt;
      &lt;/xs:extension&gt;
    &lt;/xs:simpleContent&gt;
  &lt;/xs:complexType&gt;

  &lt;xs:simpleType name="StringType"&gt;
    &lt;xs:restriction base="xs:string" /&gt;
  &lt;/xs:simpleType&gt;

  &lt;xs:simpleType name="DoubleType"&gt;
    &lt;xs:restriction base="xs:double" /&gt;
  &lt;/xs:simpleType&gt;

  &lt;xs:simpleType name="BooleanType"&gt;
    &lt;xs:restriction base="xs:boolean" /&gt;
  &lt;/xs:simpleType&gt;

  &lt;xs:simpleType name="IntegerType"&gt;
    &lt;xs:restriction base="xs:int" /&gt;
  &lt;/xs:simpleType&gt;

  &lt;xs:complexType name="ItemType"&gt;
    &lt;xs:sequence&gt;
      &lt;xs:element name="Key" type="KeyType" /&gt;
      &lt;xs:choice maxOccurs="1"&gt;
        &lt;xs:element name="Integer" type="IntegerType" /&gt;
        &lt;xs:element name="Double" type="DoubleType" /&gt;
        &lt;xs:element name="Boolean" type="BooleanType" /&gt;
        &lt;xs:element name="String" type="StringType" /&gt;
      &lt;/xs:choice&gt;
      &lt;xs:element name="Tag" type="xs:string" minOccurs="0" maxOccurs="unbounded" /&gt;
    &lt;/xs:sequence&gt;
  &lt;/xs:complexType&gt;

  &lt;xs:complexType name="DeclarationType"&gt;
    &lt;xs:sequence&gt;
      &lt;xs:element name="Item" type="ItemType" minOccurs="1" maxOccurs="unbounded" /&gt;
    &lt;/xs:sequence&gt;
  &lt;/xs:complexType&gt;

  &lt;xs:element name="Declaration" type="DeclarationType"&gt;
    &lt;xs:annotation&gt;
      &lt;xs:documentation&gt;Comment describing your root element&lt;/xs:documentation&gt;
    &lt;/xs:annotation&gt;
  &lt;/xs:element&gt;
&lt;/xs:schema&gt;
</pre> The next example lists a template that could be used to declare the same event as declared in:</dd></dl>
<p><a class="el" href="ax_event_stateless_declaration_example_8c-example.html">ax_event_stateless_declaration_example.c</a></p>
<dl class="section user"><dt>State less event declaration expressed as template</dt><dd><pre class="fragment">&lt;Declaration&gt;

  &lt;Item&gt;
    &lt;Key NameSpace="tnsaxis"&gt;topic0&lt;/Key&gt;
    &lt;String&gt;CameraApplicationPlatform&lt;/String&gt;
  &lt;/Item&gt;

  &lt;Item&gt;
    &lt;Key NameSpace="tnsaxis"&gt;topic1&lt;/Key&gt;
    &lt;String&gt;MyApplication&lt;/String&gt;
  &lt;/Item&gt;

  &lt;Item&gt;
    &lt;Key&gt;event&lt;/Key&gt;
    &lt;Boolean /&gt;
    &lt;Tag&gt;onvif-data&lt;/Tag&gt;
  &lt;/Item&gt;

&lt;/Declaration&gt;
</pre></dd></dl>
<p>See this example for how to use the template to declare the event</p>
<p><a class="el" href="ax_event_stateless_declaration_from_template_example_8c-example.html">ax_event_stateless_declaration_from_template_example.c</a></p>
<p>The next example lists a template that could be used to declare the same event as declared in:</p>
<p><a class="el" href="ax_event_property_state_declaration_example_8c-example.html">ax_event_property_state_declaration_example.c</a></p>
<dl class="section user"><dt>Property state event declaration expressed as template</dt><dd><pre class="fragment">&lt;Declaration&gt;

  &lt;Item&gt;
    &lt;Key NameSpace="tnsaxis"&gt;topic0&lt;/Key&gt;
    &lt;String&gt;CameraApplicationPlatform&lt;/String&gt;
  &lt;/Item&gt;

  &lt;Item&gt;
    &lt;Key NameSpace="tnsaxis"&gt;topic1&lt;/Key&gt;
    &lt;String&gt;MyApplication&lt;/String&gt;
  &lt;/Item&gt;

  &lt;Item&gt;
    &lt;Key&gt;feature&lt;/Key&gt;
    &lt;String&gt;myfeature&lt;/String&gt;
  &lt;/Item&gt;

  &lt;Item&gt;
    &lt;Key&gt;event&lt;/Key&gt;
    &lt;Boolean /&gt;
    &lt;Tag&gt;onvif-data&lt;/Tag&gt;
    &lt;Tag&gt;property-state&lt;/Tag&gt;
  &lt;/Item&gt;

&lt;/Declaration&gt;
</pre></dd></dl>
<p>See this example for how to use the template to declare the event:</p>
<p><a class="el" href="ax_event_property_state_declaration_from_template_example_8c-example.html">ax_event_property_state_declaration_from_template_example.c</a></p>
<p>When an event declaration is no longer needed it should be undeclared.</p>
<h2><a class="anchor" id="ax_event_handler_event_subscriptions"></a>
Event subscriptions</h2>
<p>An application can subscribe to a single event or to a set of events. In both cases, the application should create a <a class="el" href="ax__event__key__value__set_8h.html#ax_event_key_value_set_key_value_set">AXEventKeyValueSet</a> key/value set that matches the desired subscription.</p>
<p>To subscribe to a single event, for example to the I/O event above, the application should create a <a class="el" href="ax__event__key__value__set_8h.html#ax_event_key_value_set_key_value_set">AXEventKeyValueSet</a> key/value set that matches all the keys and values in the event.</p>
<pre class="fragment">   tns1:topic0=Device
tnsaxis:topic1=IO
tnsaxis:topic2=Port
          port=0
         state=1
</pre><p>An application subscribing to this key/value set will receive an event each time the value of the key <code>state</code> equals <code>1</code> on I/O port <code>0</code>.</p>
<p>To subscribe to a set of events, the application should create a <a class="el" href="ax__event__key__value__set_8h.html#ax_event_key_value_set_key_value_set">AXEventKeyValueSet</a> key/value set where some keys, values or event namesspaces are omitted. <a class="el" href="ax_event_key_value_set_example1_8c-example.html">ax_event_key_value_set_example1.c</a> <a class="el" href="ax_event_key_value_set_example2_8c-example.html">ax_event_key_value_set_example2.c</a></p>
<pre class="fragment">   tns1:topic0=Device
tnsaxis:topic1=IO
tnsaxis:topic2=Port
</pre><p>An application subscribing to the key/value set above will receive events from all I/O ports whenever their respective states change.</p>
<p>Subscriptions to stateless events and to property states are created in the same way but there is a difference in how the events are delivered to the subscription callback. As stateless events only exist when they are sent, a subscription callback associated with a stateless event will not be called until the event is sent. A subscription callback associated with a property state, which always has a well-defined state, will be called immediately after the subscription so that the subscriber always has the current state of the event. Each time the property state is updated, a new call will be performed.</p>
<p>If an application subscribes to an event that is not yet declared, the associated subscription callback will not be called until a producer declares the event.</p>
<p>The following example shows how to subscribe to an event:</p>
<p><a class="el" href="ax_event_subscription_example_8c-example.html">ax_event_subscription_example.c</a></p>
<h1><a class="anchor" id="ax_event_handler_callbacks"></a>
A note on callback functions</h1>
<p>The callback functions registered with the <code>AXEventHandler</code> will be called from the GMainLoop thread in the default context. This means that the client may not prevent callback functions from returning, nor should any lengthy processing be made in the callback functions. Failure to comply with this convention will prevent the event system from, or delay it in, sending or delivering any more events to the calling application. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="axevent_8h.html">axevent.h</a></li>
    <li class="footer">Copyright &copy; 2009-2024 Axis Communications AB. All rights reserved.</li>
  </ul>
</div>
</body>
</html>
