<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>liblarod: Changes in the larod API</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="axis-logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">liblarod
   &#160;<span id="projectnumber">3.2.254-dirty</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Changes in the larod API </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Below is a description of API-breaking changes in major version updates of the larod API. This document can thus serve as a guide for developers that want to port their applications to the latest version.</p>
<p>Note that larod features not only ABI but also API backwards compatibility. Using an older API version when compiling with a newer version of larod requires a <code>#define LAROD_API_VERSION_X</code>, see "Backwards compatibility" in introduction-for-app-developers for details.</p>
<p><b>Table of Contents</b></p>
<ul>
<li><a href="#changes-in-the-larod-api">Changes in the larod API</a><ul>
<li><a href="#larod-30">larod 3.0</a><ul>
<li><a href="#laroddevice-replaces-larodchip">larodDevice replaces larodChip</a></li>
<li><a href="#new-parameters-in-laroddestroytensors">New parameters in larodDestroyTensors()</a></li>
<li><a href="#cache-policy">Cache policy</a></li>
</ul>
</li>
<li><a href="#larod-20">larod 2.0</a><ul>
<li><a href="#set-chip-when-loading-model">Set chip when loading model</a></li>
<li><a href="#rename-inference-to-job">Rename "inference" to "job"</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2>larod 3.0</h2>
<h3>larodDevice replaces larodChip</h3>
<p>The <code>larodChip</code> enum has been replaced by a <code>larodDevice</code> handle. The following of the API is therefore deprecated:</p>
<div class="fragment"><div class="line"><span class="keyword">enum</span> <a class="code" href="larod_8h.html#a5d61d65903803a3c587e5830de34df24">larodChip</a>;</div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* larodGetChipName(<span class="keyword">const</span> <a class="code" href="larod_8h.html#a5d61d65903803a3c587e5830de34df24">larodChip</a> chip);</div><div class="line"><span class="keywordtype">bool</span> <a class="code" href="larod_8h.html#a14ad5ba9c2b5447e9424fa25077d1d70">larodListChips</a>(<a class="code" href="larod_8h.html#adf976f1fb816101078a7ac0b49a78294">larodConnection</a>* conn, <a class="code" href="larod_8h.html#a5d61d65903803a3c587e5830de34df24">larodChip</a>** chips,</div><div class="line">                    <span class="keywordtype">size_t</span>* numChips, <a class="code" href="structlarodError.html">larodError</a>** error);</div><div class="line"><a class="code" href="larod_8h.html#a5d61d65903803a3c587e5830de34df24">larodChip</a> <a class="code" href="larod_8h.html#aa3ab5cc53e4e83cbebb60d394028ecbc">larodGetModelChip</a>(<span class="keyword">const</span> <a class="code" href="larod_8h.html#a9e56e66ffecad46856d96bc289b6ce5a">larodModel</a>* model,</div><div class="line">                            <a class="code" href="structlarodError.html">larodError</a>** error);</div></div><!-- fragment --><p>To replace them, the larod 3.0 API introduces:</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="larod_8h.html#aef607537eb94843735472c4afba5fd87">larodDevice</a> <a class="code" href="larod_8h.html#aef607537eb94843735472c4afba5fd87">larodDevice</a>;</div><div class="line"><span class="keyword">const</span> <a class="code" href="larod_8h.html#aef607537eb94843735472c4afba5fd87">larodDevice</a>* <a class="code" href="larod_8h.html#a29a9707a190c2d0c44f7e50f942b2621">larodGetDevice</a>(<span class="keyword">const</span> <a class="code" href="larod_8h.html#adf976f1fb816101078a7ac0b49a78294">larodConnection</a>* conn, <span class="keyword">const</span> <span class="keywordtype">char</span>* name,</div><div class="line">                                  <span class="keyword">const</span> uint32_t instance, <a class="code" href="structlarodError.html">larodError</a>** error);</div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="larod_8h.html#ab0279d8c0983a66e6c4a6476f2be48cd">larodGetDeviceName</a>(<span class="keyword">const</span> <a class="code" href="larod_8h.html#aef607537eb94843735472c4afba5fd87">larodDevice</a>* dev, <a class="code" href="structlarodError.html">larodError</a>** error);</div><div class="line"><span class="keywordtype">bool</span> <a class="code" href="larod_8h.html#a01cff6ed219ba19726567d881e624d7d">larodGetDeviceInstance</a>(<span class="keyword">const</span> <a class="code" href="larod_8h.html#aef607537eb94843735472c4afba5fd87">larodDevice</a>* dev, uint32_t* instance,</div><div class="line">                            <a class="code" href="structlarodError.html">larodError</a>** error);</div><div class="line"><span class="keyword">const</span> <a class="code" href="larod_8h.html#aef607537eb94843735472c4afba5fd87">larodDevice</a>** <a class="code" href="larod_8h.html#a23e4b862c843907b8c25164df07b22ed">larodListDevices</a>(<a class="code" href="larod_8h.html#adf976f1fb816101078a7ac0b49a78294">larodConnection</a>* conn, <span class="keywordtype">size_t</span>* numDevices,</div><div class="line">                                     <a class="code" href="structlarodError.html">larodError</a>** error);</div><div class="line"><span class="keyword">const</span> <a class="code" href="larod_8h.html#aef607537eb94843735472c4afba5fd87">larodDevice</a>* <a class="code" href="larod_8h.html#a191112e4b24804d94cf7bdd227576f85">larodGetModelDevice</a>(<span class="keyword">const</span> <a class="code" href="larod_8h.html#a9e56e66ffecad46856d96bc289b6ce5a">larodModel</a>* model,</div><div class="line">                                       <a class="code" href="structlarodError.html">larodError</a>** error);</div></div><!-- fragment --><p>Instead of choosing a <code>larodChip</code> when loading a model, a user of liblarod should now ask for a <code>larodDevice</code> handle with <code><a class="el" href="larod_8h.html#a29a9707a190c2d0c44f7e50f942b2621" title="Get an available device. ">larodGetDevice()</a></code>, e.g.</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <a class="code" href="larod_8h.html#aef607537eb94843735472c4afba5fd87">larodDevice</a>* dev = <a class="code" href="larod_8h.html#a29a9707a190c2d0c44f7e50f942b2621">larodGetDevice</a>(conn, <span class="stringliteral">&quot;cpu-tflite&quot;</span>, 0, &amp;error);</div></div><!-- fragment --><p>The list of available strings like "cpu-tflite" can be found in nn-inference.md. This handle is then passed on when loading model, which means that the following functions have a signature change:</p>
<div class="fragment"><div class="line"><a class="code" href="larod_8h.html#a9e56e66ffecad46856d96bc289b6ce5a">larodModel</a>* <a class="code" href="larod_8h.html#a41b5e5179aa68b382e024945254a5770">larodLoadModel</a>(<a class="code" href="larod_8h.html#adf976f1fb816101078a7ac0b49a78294">larodConnection</a>* conn, <span class="keyword">const</span> <span class="keywordtype">int</span> fd,</div><div class="line">                           <span class="keyword">const</span> <a class="code" href="larod_8h.html#aef607537eb94843735472c4afba5fd87">larodDevice</a>* dev <span class="comment">/* changed */</span>,</div><div class="line">                           <span class="keyword">const</span> <a class="code" href="larod_8h.html#a41ad6dc8e9f9ffebc03faf115167aba5">larodAccess</a> access, <span class="keyword">const</span> <span class="keywordtype">char</span>* name,</div><div class="line">                           <span class="keyword">const</span> <a class="code" href="larod_8h.html#a480ba7618e79ad250c166c52d216ab79">larodMap</a>* params, <a class="code" href="structlarodError.html">larodError</a>** error);</div><div class="line"><span class="keywordtype">bool</span> <a class="code" href="larod_8h.html#ab4073f88052a8b3c4804683903e84001">larodLoadModelAsync</a>(<a class="code" href="larod_8h.html#adf976f1fb816101078a7ac0b49a78294">larodConnection</a>* conn, <span class="keyword">const</span> <span class="keywordtype">int</span> inFd,</div><div class="line">                         <span class="keyword">const</span> <a class="code" href="larod_8h.html#aef607537eb94843735472c4afba5fd87">larodDevice</a>* dev <span class="comment">/* changed */</span>,</div><div class="line">                         <span class="keyword">const</span> <a class="code" href="larod_8h.html#a41ad6dc8e9f9ffebc03faf115167aba5">larodAccess</a> access,</div><div class="line">                         <span class="keyword">const</span> <span class="keywordtype">char</span>* name, <span class="keyword">const</span> <a class="code" href="larod_8h.html#a480ba7618e79ad250c166c52d216ab79">larodMap</a>* params,</div><div class="line">                         <a class="code" href="larod_8h.html#aa4057108f02e9886b7992bd7726d10c4">larodLoadModelCallback</a> callback, <span class="keywordtype">void</span>* userData,</div><div class="line">                         <a class="code" href="structlarodError.html">larodError</a>** error);</div></div><!-- fragment --><h3>Migration table from larodChip enums to larodDevice strings</h3>
<table class="doxtable">
<tr>
<th>2.0 enum </th><th>3.0 string  </th></tr>
<tr>
<td><code>LAROD_CHIP_DEBUG</code> </td><td><code>debug-device</code> </td></tr>
<tr>
<td><code>LAROD_CHIP_TFLITE_CPU</code> </td><td><code>cpu-tflite</code> </td></tr>
<tr>
<td><code>LAROD_CHIP_TPU</code> </td><td><code>google-edge-tpu-tflite</code> </td></tr>
<tr>
<td><code>LAROD_CHIP_CVFLOW_NN</code> </td><td><code>ambarella-cvflow</code> </td></tr>
<tr>
<td><code>LAROD_CHIP_TFLITE_GLGPU</code> </td><td><code>gpu-tflite</code> </td></tr>
<tr>
<td><code>LAROD_CHIP_CVFLOW_PROC</code> </td><td><code>ambarella-cvflow-proc</code> </td></tr>
<tr>
<td><code>LAROD_CHIP_ACE</code> </td><td><code>axis-a8-ace-proc</code> </td></tr>
<tr>
<td><code>LAROD_CHIP_LIBYUV</code> </td><td><code>cpu-proc</code> </td></tr>
<tr>
<td><code>LAROD_CHIP_TFLITE_ARTPEC8DLPU</code> </td><td><code>axis-a8-dlpu-tflite</code> </td></tr>
<tr>
<td><code>LAROD_CHIP_OPENCL</code> </td><td><code>axis-a7-gpu-proc</code> (deprecated) </td></tr>
<tr>
<td><code>LAROD_CHIP_OPENCL</code> </td><td><code>axis-a8-gpu-proc</code> </td></tr>
<tr>
<td><code>LAROD_CHIP_OPENCL</code> </td><td><code>axis-a8-dlpu-proc</code> (see below) </td></tr>
</table>
<p>Starting from larod 3.0 <code>LAROD_CHIP_OPENCL</code> is split into multiple devices, one for each OpenCL-supporting hardware, as shown in the table above. If you are using this enum on ARTPEC-7 you should use <code>axis-a7-gpu-proc</code>. If you are using this enum on ARTPEC-8 you may use either <code>axis-a8-gpu-proc</code>, which will select the GPU, or <code>axis-a8-dlpu-proc</code>, which selects the DLPU. Either should work.</p>
<p>Note that <code>axis-a7-gpu-proc</code> is deprecated and is no longer being tested. It is recommended to use <code>cpu-proc</code> instead.</p>
<h3>New parameters in <a class="el" href="larod_8h.html#afac99dfef68ffe3d513008aaac354ae0" title="Destroy a list of larodTensor. ">larodDestroyTensors()</a></h3>
<p>When using buffers that are allocated by larod (using e.g. <code><a class="el" href="larod_8h.html#ad8be991c1295938b95df0c2dbd6d1ad7" title="Create and allocate input tensors from a model. ">larodAllocModelInputs()</a></code>), <code><a class="el" href="larod_8h.html#afac99dfef68ffe3d513008aaac354ae0" title="Destroy a list of larodTensor. ">larodDestroyTensors()</a></code> now also deallocate these buffers. Therefore the function signature has been changed to</p>
<div class="fragment"><div class="line"><span class="keywordtype">bool</span> <a class="code" href="larod_8h.html#afac99dfef68ffe3d513008aaac354ae0">larodDestroyTensors</a>(<a class="code" href="larod_8h.html#adf976f1fb816101078a7ac0b49a78294">larodConnection</a>* conn <span class="comment">/* new */</span>,</div><div class="line">                         <a class="code" href="larod_8h.html#a07d4c60d47a09a1c1508b8f9b8db3783">larodTensor</a>*** tensors, <span class="keywordtype">size_t</span> numTensors,</div><div class="line">                         <a class="code" href="structlarodError.html">larodError</a>** error <span class="comment">/* new */</span>);</div></div><!-- fragment --><h3>Cache policy</h3>
<p>Clients that use DMA buffers are now responsible for handling all the cache synchronization. See "About dma-buf" in nn-inference.md for details.</p>
<h2>larod 2.0</h2>
<h3>Set chip when loading model</h3>
<p>Chip is now tied to the larodModel being loaded instead of the larodConnection. Hence, the following functions are removed:</p>
<div class="fragment"><div class="line"><a class="code" href="larod_8h.html#a5ef0861f09126b208976c79f1dd62165">larodGetChipType</a>()</div><div class="line"><a class="code" href="larod_8h.html#a73aac39f182e0d2100479a933415c4fa">larodGetChipId</a>()</div><div class="line"><a class="code" href="larod_8h.html#ae609b1a5bd906bdffc4b8c42cde33bd7">larodSetChipId</a>()</div><div class="line"><a class="code" href="larod_8h.html#a72e9f822f0c83d0f8b98eb296e0dda81">larodSetChip</a>()</div></div><!-- fragment --><p>Instead, one specifies the chip as an argument to <code><a class="el" href="larod_8h.html#a41b5e5179aa68b382e024945254a5770" title="Load a new model. ">larodLoadModel()</a></code> and <code><a class="el" href="larod_8h.html#ab4073f88052a8b3c4804683903e84001" title="Load a new model asynchronously. ">larodLoadModelAsync()</a></code>. There is also an additional argument, <code>larodMap</code>, that can be used for back end specific parameters. When converting code from v1.0 to v2.0, the <code>larodMap</code> parameter can be set to <code>NULL</code>.</p>
<h3>Rename "inference" to "job"</h3>
<p>Since larod 2.0 introduces image processing capabilities, larod is no longer a pure inference service. Therefore, the word "Inference" has been replaced with "Job". For example, <code><a class="el" href="larod_8h.html#a943e66698058355a7feecaf2e1ba1513" title="Type describing a job request. ">larodInferenceRequest()</a></code> is now called <code><a class="el" href="larod_8h.html#a8f6f0898b3a3c25a07582687b6095265" title="Type describing a job request. ">larodJobRequest()</a></code>. Additionally, <code><a class="el" href="larod_8h.html#af25e0293b11b12fb8e296fb20c828159" title="Create and initialize a job request handle. ">larodCreateJobRequest()</a></code> needs a <code>larodMap</code> parameter. When converting code from v1.0 to v2.0 the <code>larodMap</code> parameter can be set to <code>NULL</code>.</p>
<p>The following tables show the errors, structs and functions that have changed name, respectively:</p>
<table class="doxtable">
<tr>
<th>1.0 </th><th>2.0  </th></tr>
<tr>
<td><code>LAROD_ERROR_INFERENCE</code> </td><td><code>LAROD_ERROR_JOB</code> </td></tr>
</table>
<table class="doxtable">
<tr>
<th>1.0 </th><th>2.0  </th></tr>
<tr>
<td><code>larodInferenceRequest</code> </td><td><code>larodJobRequest</code> </td></tr>
</table>
<table class="doxtable">
<tr>
<th>1.0 </th><th>2.0  </th></tr>
<tr>
<td><code>larodCreateInferenceRequest</code> </td><td><code>larodCreateJobRequest</code> </td></tr>
<tr>
<td><code>larodDestroyInferenceRequest</code> </td><td><code>larodDestroyJobRequest</code> </td></tr>
<tr>
<td><code>larodSetInferenceRequestModel</code> </td><td><code>larodSetJobRequestModel</code> </td></tr>
<tr>
<td><code>larodSetInferenceRequestInputs</code> </td><td><code>larodSetJobRequestInputs</code> </td></tr>
<tr>
<td><code>larodSetInferenceRequestOutputs</code> </td><td><code>larodSetJobRequestOutputs</code> </td></tr>
<tr>
<td><code>larodSetInferenceRequestPriority</code> </td><td><code>larodSetJobRequestPriority</code> </td></tr>
<tr>
<td><code>larodRunInference</code> </td><td><code>larodRunJob</code> </td></tr>
<tr>
<td><code>larodRunInferenceAsync</code> </td><td><code>larodRunJobAsync</code> </td></tr>
<tr>
<td><code>larodRunInferenceCallback</code> </td><td><code>larodRunJobCallback</code> </td></tr>
</table>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Copyright &copy; 2009-2025 Axis Communications AB. All rights reserved.
</small></address>
</body>
</html>
