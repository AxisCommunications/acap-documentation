<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>liblarod: Architecture</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="axis-logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">liblarod
   &#160;<span id="projectnumber">3.2.21</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Architecture </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>larod is intended to run as a <code>systemd</code> service and to be interfaced through a <code>C</code> <a href="../lib/larod.h">library</a> (from now on <em>larod</em> will refer to the service, if not stated otherwise). A program that uses this library, to connect to larod, will be referred to as a <em>client</em>. larod supports multiple clients at the same time.</p>
<p>Each client can load neural networks or other processing models (we will refer to these as just <em>model</em> in the future), run jobs and more to a specific device designed for accelerating these operations (including CPU's or on-chip IP blocks). If multiple devices are present, clients can choose between these using the API provided by the library.</p>
<p>Below we will describe different parts of larod in more detail. This can therefore get technical and can be skipped if you are not intending to work directly with the source code of larod.</p>
<h2>Service</h2>
<p>When clients connects to larod, using the library, an initial handshake is initiated over the D-Bus protocol with the _<code>Service</code>_. The <code>Service</code> manages the back end devices available for accelerating computation. It also manages _<code>Session</code>s_, which we will explain further in the next section.</p>
<p>Moreover, it exposes a D-Bus interface for creating <code>Session</code>s. However, the library should be used to connect to the <code>Service</code> (it has some more functionality than just calling the <code>Service</code>'s D-Bus interface).</p>
<h3>Session</h3>
<p>After the initial handshake upon connecting to larod, the <code>Service</code> object creates a unique _<code>Session</code>_. A <code>Session</code> is an object which has exactly one client associated to it. If a client disconnects from larod, the associated <code>Session</code> gets destroyed as well (and all data specific to just that <code>Session</code>).</p>
<p>Using <code>Session</code>s, clients can run various <em>commands</em>. Examples of commands are loading and deleting models, running jobs and more. <code>Session</code>s can use all devices provided by <code>Service</code> during the construction of <code>Session</code> and a device is represented in larod as a _<code>BackEndUnit</code>_ object.</p>
<h3>BackEndUnit</h3>
<p>A _<code>BackEndUnit</code>_ is an abstract class representing a general device and software interface for accelerating computation of a model. It declares some abstract functions for the device such as loading and deleting a model, running jobs, and more. A concrete class representing an actual computational unit will thus sub-class <code>BackEndUnit</code> and override the previously stated abstract functions.</p>
<p><code>BackEndUnit</code> also provides asynchronous loading of models and running of jobs. It does so by queuing these requests and letting the sub-class process these queues in its implementation-defined way. Furthermore, it maintains a list of <code>Model</code>s loaded to it and their respective creators (models can be private or public, meaning that only the creator can modify it or anyone, respectively.)</p>
<h3>The big picture</h3>
<p>The figure below summarizes the different parts in larod and their relation to each other. Note that <code>--&lt;&gt;</code> in the figure represents so called <em>aggregation</em> in <a href="https://en.wikipedia.org/wiki/Class_diagram">UML class diagrams</a>, i.e. "has a" relationship. While <code>--&lt;x&gt;</code> represents a <em>composition</em> relationship and <code>A</code> symbolizes an empty triangle, i.e. inheritance ("is a" relationship).</p>
<div class="fragment"><div class="line">.--------.         .----------.</div><div class="line">|        |         |          |</div><div class="line">| Client |-------&lt;&gt;| liblarod |&lt;--------------------.</div><div class="line">|        |         |          |                     |</div><div class="line">&#39;--------&#39;         &#39;----------&#39;                     |</div><div class="line">                         ^                          |</div><div class="line">                         |                          |</div><div class="line">                         | D-Bus                    |</div><div class="line">                         |                          | D-Bus</div><div class="line">                         V                          |</div><div class="line">                   .-----------.                    |</div><div class="line">                   |           |                    |</div><div class="line">           .-------+  Service  +------.             |</div><div class="line">           |       |           |      |             |</div><div class="line">           |       &#39;-----------&#39;      |             |</div><div class="line">           |                          |             V</div><div class="line">           |                          |        .---------.</div><div class="line">           |                          |        |         |</div><div class="line">           |                          &#39;-----&lt;x&gt;| Session |</div><div class="line">           |                                   |         |</div><div class="line">           |                                   &#39;----+----&#39;</div><div class="line">           |      .-------------.                   |</div><div class="line">           |      |             |                   |</div><div class="line">           +---&lt;x&gt;| BackEndUnit |&lt;&gt;-----------------&#39;</div><div class="line">                  |             |</div><div class="line">                  &#39;-------------&#39;</div><div class="line">                     A   A   A</div><div class="line">                     |   |   |</div><div class="line">        .------------&#39;   |   &#39;------------.</div><div class="line">        |                |                |</div><div class="line">        |                |                |</div><div class="line">        |                |                |</div><div class="line">   .----+-----.    .-----+----.     .-----+----.</div><div class="line">   |          |    |          |     |          |</div><div class="line">   | Device X |    | Device Y |     | Device Z |</div><div class="line">   |          |    |          |     |          |</div><div class="line">   &#39;----------&#39;    &#39;----------&#39;     &#39;----------&#39;</div></div><!-- fragment --><p>Beginning from the upper left box, a client communicates with the <code>Service</code> and its <code>Session</code> through the library. The client can get the number of active <code>Session</code>s from the <code>Service</code>. Clients can also call commands specified in <code>Session</code> through the library. For example loading models, running jobs and more.</p>
<p>The <code>Service</code> has a list of <code>BackEndUnit</code>s that it creates and manages. The exact types of <code>BackEndUnit</code>s are decided at compile time and corresponds to what is actually available on the hardware. Moreover, it manages the <code>Session</code>s for all connected clients. Whenever a client disconnects, <code>Service</code> makes sure the corresponding <code>Session</code> destructs as well.</p>
<p><code>Session</code> has references to the <code>BackEndUnit</code>s available. Note however that it is the <code>Service</code> that is responsible for the <code>BackEndUnit</code>s lifetime, i.e. several <code>Session</code>s can use the same device and it is not deallocated when the last <code>Session</code> having a reference to it destructs.</p>
<p>Since several <code>Session</code>s can use the same <code>BackEndUnit</code>, all relevant synchronization happens in the <code>BackEndUnit</code> class. Device <code>X</code>, <code>Y</code> and <code>Z</code> are (made-up) examples of real chips that may sub-class <code>BackEndUnit</code>. The actual functionality of loading models and running jobs resides in these respective classes. </p>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Copyright &copy; 2009-2023 Axis Communications AB. All rights reserved.
</small></address>
</body>
</html>
