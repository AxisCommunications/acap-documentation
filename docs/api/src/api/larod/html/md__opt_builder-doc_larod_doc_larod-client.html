<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>liblarod: The larod-client tool</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="axis-logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">liblarod
   &#160;<span id="projectnumber">3.1.125-1-g8add087c</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">The larod-client tool </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><code>larod-client</code> is a small program that uses the larod API in the same way as a typical application would do. Command line options and an interactive mode makes it easy to interact with the larod service. Some use case examples are listed in this file; please refer to the tool help (<code>--help</code> option) and ultimately the source code for nitty-gritty-details.</p>
<h2>Use case examples</h2>
<h3>Listing the available backends in a running system</h3>
<p>A useful sanity check of larod service running is to just list the available <code>larodDevice</code>s in the system:</p>
<div class="fragment"><div class="line">larod-client -a</div></div><!-- fragment --><p>Also the backend names listed are the identifiers that should be passed as the backend name as the <code>-c</code> option in most other <code>larod-client</code> use-cases.</p>
<h3>Loading a neural network model and running an inference job</h3>
<p>Here is an example of loading a model and executing an inference job using the TFLite CPU backend:</p>
<div class="fragment"><div class="line">larod-client -d -c cpu-tflite -g ./mobilenet_v2_1.0_224_quant.tflite \</div><div class="line">-i ./goldfish_224x224_uint8_RGB.bin -o ./goldfish-result.bin</div></div><!-- fragment --><p>This will load the MobileNetV2 model on the TFLite CPU backend, then perform one inference of the test image <code>goldfish_224x224_uint8_RGB.bin.</code> The binary output from the model is written to the file goldfish-result.bin.</p>
<h4>Running inferences using random input data</h4>
<p>It is possible to instruct larod-client to generate random input data for you, instead of having to supply an input file. This can be achieved by passing an empty string as input file for a job:</p>
<div class="fragment"><div class="line">larod-client -d -c cpu-tflite -g ./mobilenet_v2_1.0_224_quant.tflite -i &quot;&quot; \</div><div class="line">-o ./random-data-output.bin</div></div><!-- fragment --><p>This command will run an inference using random data as input, and write the output from this inference to the file random-data-output.bin.</p>
<p>The option <code>--random-seed</code> allows you to specify the seed number to use for the random input data. If this option is omitted larod-client will use the system clock as seed. For a given seed the random numbers generated will always be the same. This can be useful for debugging.</p>
<h3>Benchmarking a model</h3>
<p><code>larod-client</code> can be used to benchmark job times for a model. Here is an example:</p>
<div class="fragment"><div class="line">larod-client -R 1000 -c cpu-tflite -g ./mobilenet_v2_1.0_224_quant.tflite \</div><div class="line">-i ./goldfish_224x224_uint8_RGB.bin</div></div><!-- fragment --><p>Command line above loads the model and executes 1000 inference jobs on the model, then reports the average time per job.</p>
<h4>Running asynchronously for maximum device utilization</h4>
<p>One can achieve higher utilization (and thus performance) by ensuring that the device always has a job request ready after finishing a previous one. This can be accomplished by running the jobs asynchronously (i.e. queuing up the requests) with option <code>-q</code>:</p>
<div class="fragment"><div class="line">larod-client -R 1000 -q -c cpu-tflite -g ./mobilenet_v2_1.0_224_quant.tflite \</div><div class="line">-i ./goldfish_224x224_uint8_RGB.bin</div></div><!-- fragment --><h4>Minimizing overhead by tracking the tensors</h4>
<p>One can instruct larod to cache tensors for a model. This often results in fewer maintenance calls, yielding slightly higher performance and load. The options <code>-X</code> and <code>-Y</code> tracks the input and output tensors, respectively:</p>
<div class="fragment"><div class="line">larod-client -R 1000 -q -c cpu-tflite -g ./mobilenet_v2_1.0_224_quant.tflite \</div><div class="line">-i ./goldfish_224x224_uint8_RGB.bin -X -Y</div></div><!-- fragment --><h3>Running jobs indefinitely for maximum load</h3>
<p><code>larod-client</code> can be instructed to run jobs continuously. This can be used to add load to a system, e.g. to measure power consumption and temperature for a particular device. Set number-of-rounds to 0 to run continuously (note the use of the <code>-q</code> option for maximum load, see section ["Running asynchronously for maximum device utilization"](#running-asynchronously-for-maximum-device-utilization) above):</p>
<div class="fragment"><div class="line">larod-client -R 0 -q -c cpu-tflite -g ./mobilenet_v2_1.0_224_quant.tflite \</div><div class="line">-i ./goldfish_224x224_uint8_RGB.bin</div></div><!-- fragment --><h3>Executing a preprocessing job</h3>
<p>One can use <code>larod-client</code> to execute an image pre-processing job as well. Here is an example using the libyuv backend (<code>cpu-proc</code>) to convert an image from nv12/YCbCr to RGB interleaved:</p>
<div class="fragment"><div class="line">larod-client -c cpu-proc -b image.input.size:224,224 \</div><div class="line">-b image.input.format:nv12 -b image.output.size:224,224 \</div><div class="line">-b image.output.format:rgb-interleaved -i goldfish-224x224.nv12 \</div><div class="line">-o ./goldfish-224x224.rgb</div></div><!-- fragment --><p>Image pre-processing models models are specified by supplying set of key/value pairs when loading the model: these key/value pairs are supplied by the <code>-b</code> option. Please refer to the [preprocessing.md] documentation for details on how to specify a pre-processing model.</p>
<h3>Using the interactive mode</h3>
<p>The "interactive mode" in <code>larod-client</code> can be started by providing the <code>-r</code> option. The interactive mode parses the input provided by the user on stdin and parses the lines like they were passed as command-line options. Here is an example interactive session:</p>
<div class="fragment"><div class="line"># larod-client -r</div><div class="line">2021-09-21T12:55:04.224 Connecting to larod...</div><div class="line">2021-09-21T12:55:04.225 Connected</div><div class="line">2021-09-21T12:55:04.225 larod-client 3.0.30-1. Use Ctrl-D to exit.</div><div class="line">&gt; -c cpu-tflite -R 1 -g ./mobilenet_v2_1.0_224_quant.tflite \</div><div class="line">-i ./goldfish_224x224_uint8_RGB.bin</div><div class="line">2021-09-21T12:55:25.358 Model mobilenet_v2_1.0_224_quant.tflite loaded</div><div class="line">total time = 0</div><div class="line">2021-09-21T12:55:25.388 Output written to:</div><div class="line">2021-09-21T12:55:25.388         goldfish_224x224_uint8_RGB.bin.out0</div></div><!-- fragment --><h4>Why don't I get any <code>--interactive</code> option in larod-client?</h4>
<p>The interactive modes uses <code>libreadline</code> to read the commands from <code>stdin</code>. This library is not always present e.g. when building for an embedded target, thus the larod meson files are written to pick up <code>libreadline</code> optionally. If it's present in build environment the interactive mode will be included when building <code>larod-client</code>. Please check that <code>libreadline</code> is present in your build environment if you want to use the interactive mode.</p>
<h3>Using dma-buf input and output for zero-copy</h3>
<p>larod supports using dma-buf buffers for input and output. <code>larod-client</code> can allocate and run jobs with such buffers. Here is an example of running a convolutional neural network inference on Ambarella CVFlow using larod-allocated dma-buf for input and output:</p>
<div class="fragment"><div class="line">larod-client -d -c ambarella-cvflow -g ./tf_mobilenet_v2_cavalry.bin \</div><div class="line">-i ./missile_224x224_uint8_RGB.bin -o ./missile-result.bin -I larod-dma \</div><div class="line">-O larod-dma</div></div><!-- fragment --><p>The options <code>--output-buf-type</code> and <code>--input-buf-type</code> are used to select the types of buffers. When types other than <code>ext-disk</code> are used <code>larod-client</code> will allocate buffers and then copy data into the input buffer(s) before starting the job. Similarly output data in the tempory buffers is written to disk when the job is done. Please refer to dma-buf.md for details on the buffer handling. </p>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Copyright &copy; 2009-2022 Axis Communications AB. All rights reserved.
</small></address>
</body>
</html>
