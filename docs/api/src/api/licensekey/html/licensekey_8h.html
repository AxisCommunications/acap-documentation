<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LicenseKey: licensekey.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="axis-logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">LicenseKey
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('licensekey_8h.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">licensekey.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>License key interface.  
<a href="#details">More...</a></p>

<p><a href="licensekey_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aa5a498663768810b342e34519f640c93"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="licensekey_8h.html#aa5a498663768810b342e34519f640c93">licensekey_verify</a> (const char *app_name, int app_id, int major_version, int minor_version)</td></tr>
<tr class="memdesc:aa5a498663768810b342e34519f640c93"><td class="mdescLeft">&#160;</td><td class="mdescRight">Perform a license key check.  <a href="#aa5a498663768810b342e34519f640c93">More...</a><br /></td></tr>
<tr class="separator:aa5a498663768810b342e34519f640c93"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a561f2b2eae4773456c7f5cbc083f4350"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="licensekey_8h.html#a561f2b2eae4773456c7f5cbc083f4350">licensekey_verify_ex</a> (const char *app_name, int app_id, int major_version, int minor_version, const char *licensekey_path)</td></tr>
<tr class="memdesc:a561f2b2eae4773456c7f5cbc083f4350"><td class="mdescLeft">&#160;</td><td class="mdescRight">Perform a license key check for ACAP3 applications.  <a href="#a561f2b2eae4773456c7f5cbc083f4350">More...</a><br /></td></tr>
<tr class="separator:a561f2b2eae4773456c7f5cbc083f4350"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4be8f8d8b5cc5f87afaae2db2f539e79"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="licensekey_8h.html#a4be8f8d8b5cc5f87afaae2db2f539e79">licensekey_get_exp_date</a> (const char *app_name, const char *licensekey_path)</td></tr>
<tr class="memdesc:a4be8f8d8b5cc5f87afaae2db2f539e79"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the expiration date of the license.  <a href="#a4be8f8d8b5cc5f87afaae2db2f539e79">More...</a><br /></td></tr>
<tr class="separator:a4be8f8d8b5cc5f87afaae2db2f539e79"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8eb47819f293c8350cc349e80d9efab0"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="licensekey_8h.html#a8eb47819f293c8350cc349e80d9efab0">licensekey_get_state_string</a> (const int state_code)</td></tr>
<tr class="memdesc:a8eb47819f293c8350cc349e80d9efab0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return an explicatory message of a license key state for ACAP3 applications.  <a href="#a8eb47819f293c8350cc349e80d9efab0">More...</a><br /></td></tr>
<tr class="separator:a8eb47819f293c8350cc349e80d9efab0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>License key interface. </p>
<p>The license key interface checks that an application has a valid license key installed. To receive a license key the user enters the application's license code and the device's serial number on the Axis web service page called Embedded Applications.</p>
<p>The license key is created by Axis in XML-format with a description of the application and a signature that is verified by the License key library using a public RSA-key that resides in the device.</p>
<pre class="fragment">This library is partitioned into a static and a dynamic part.  The static part performs checks to make sure that the dynamic part is not circumvented by malicious users. Both parts of the library must be linked to for the check to work.


When linking the application, provide the following option to the
compiler:
</pre> <div class="fragment"><div class="line">-Wl,-Bstatic -llicensekey_stat -Wl,-Bdynamic -llicensekey -ldl</div></div><!-- fragment --><p> The <code>-Wl</code> option tells the compiler to forward the following comma-separated options to the linker.</p>
<h1><a class="anchor" id="ex"></a>
Example</h1>
<p>This is an example of the code to verify the license key. </p><div class="fragment"><div class="line"><span class="preprocessor">#define APP_ID 123</span></div><div class="line"><span class="preprocessor">#define MAJOR_VERSION 1</span></div><div class="line"><span class="preprocessor">#define MINOR_VERSION 2</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main()</div><div class="line">{</div><div class="line">  <span class="keywordflow">if</span> (<a class="code" href="licensekey_8h.html#aa5a498663768810b342e34519f640c93">licensekey_verify</a>(app_name, APP_ID, MAJOR_VERSION, MINOR_VERSION) != 1) {</div><div class="line">    syslog(LOG_ERR, <span class="stringliteral">&quot;License key verification failed&quot;</span>);</div><div class="line">    exit(1);</div><div class="line">  }</div><div class="line"></div><div class="line">  ...</div><div class="line">  ...</div><div class="line">}</div></div><!-- fragment --><h1><a class="anchor" id="anti_debugging"></a>
Anti debugging (ptrace)</h1>
<p>Hackers who are trying to circumvent the copy protection schemes commonly use debuggers. A common tool for Linux is the ptrace(2) system call. When used for debugging it is first called from within an application and then the target application is excuted using one of the exec() calls. To make the application more secure call ptrace from within the application. If the application is being debugged using ptrace, the call will fail, since it has already been called once from within. </p><div class="fragment"><div class="line">is_debugged = (ptrace(PTRACE_TRACEME, 0, 0, 0) == -1);</div></div><!-- fragment --> </div><h2 class="groupheader">Function Documentation</h2>
<a id="aa5a498663768810b342e34519f640c93"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa5a498663768810b342e34519f640c93">&#9670;&nbsp;</a></span>licensekey_verify()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int licensekey_verify </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>app_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>app_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>major_version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>minor_version</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Perform a license key check. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">app_name</td><td>The name of the application. Must match APPNAME in package.conf.</td></tr>
    <tr><td class="paramname">app_id</td><td>The application id of the application, assigned by Axis. Must match APPID in package.conf.</td></tr>
    <tr><td class="paramname">major_version</td><td>The major version of the application. Must match APPMAJORVERSION in package.conf.</td></tr>
    <tr><td class="paramname">minor_version</td><td>The minor version of the application. Must match APPMINORVERSION in package.conf.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>1 on success, 0 on failure. </dd></dl>

</div>
</div>
<a id="a561f2b2eae4773456c7f5cbc083f4350"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a561f2b2eae4773456c7f5cbc083f4350">&#9670;&nbsp;</a></span>licensekey_verify_ex()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int licensekey_verify_ex </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>app_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>app_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>major_version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>minor_version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>licensekey_path</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Perform a license key check for ACAP3 applications. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">app_name</td><td>The name of the application. Must match APPNAME in package.conf.</td></tr>
    <tr><td class="paramname">app_id</td><td>The application id of the application, assigned by Axis. Must match APPID in package.conf.</td></tr>
    <tr><td class="paramname">major_version</td><td>The major version of the application. Must match APPMAJORVERSION in package.conf.</td></tr>
    <tr><td class="paramname">minor_version</td><td>The minor version of the application. Must match APPMINORVERSION in package.conf.</td></tr>
    <tr><td class="paramname">licensekey_path</td><td>Optional license key path meant to be used mainly for acap3 but is also available for acap2. Defaults to the acap2 license key folder.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>integer with license key state. The corresponding state message may be retrieved with function <a class="el" href="licensekey_8h.html#a8eb47819f293c8350cc349e80d9efab0" title="Return an explicatory message of a license key state for ACAP3 applications. ">licensekey_get_state_string()</a>. </dd></dl>

</div>
</div>
<a id="a4be8f8d8b5cc5f87afaae2db2f539e79"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4be8f8d8b5cc5f87afaae2db2f539e79">&#9670;&nbsp;</a></span>licensekey_get_exp_date()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* licensekey_get_exp_date </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>app_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>licensekey_path</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return the expiration date of the license. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">app_name</td><td>The name of the application. Must match APPNAME in package.conf.</td></tr>
    <tr><td class="paramname">licensekey_path</td><td>Optional license key path meant to be used mainly for acap3 but is also available for acap2. Defaults to the acap2 license key folder.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>string with the expiration date in YYYY-MM-DD format. </dd>
<dd>
NULL if the expiration date couldn't be read </dd></dl>

</div>
</div>
<a id="a8eb47819f293c8350cc349e80d9efab0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8eb47819f293c8350cc349e80d9efab0">&#9670;&nbsp;</a></span>licensekey_get_state_string()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* licensekey_get_state_string </td>
          <td>(</td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>state_code</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return an explicatory message of a license key state for ACAP3 applications. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">state_code</td><td>Integer with license key state.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>string with license key state message, needs to be freed with g_free() </dd>
<dd>
NULL if state is not a valid error state </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="licensekey_8h.html">licensekey.h</a></li>
    <li class="footer">Copyright &copy; 2009-2024 Axis Communications AB. All rights reserved.</li>
  </ul>
</div>
</body>
</html>
