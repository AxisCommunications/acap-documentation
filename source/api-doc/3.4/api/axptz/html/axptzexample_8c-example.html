<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AXptz: axptzexample.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="axis-logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AXptz
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('axptzexample_8c-example.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">axptzexample.c</div>  </div>
</div><!--header-->
<div class="contents">
<p><a class="el" href="axptzexample_8c-example.html">axptzexample.c</a></p>
<div class="fragment"><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * This is an example application that demonstrates how to use the axptz library.</span></div><div class="line"><span class="comment"> * It does not contain examples that cover all of the axptz library functions,</span></div><div class="line"><span class="comment"> * the purpose of this example application is to give the end user some basic</span></div><div class="line"><span class="comment"> * knowledge on how to use the library.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;syslog.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;fixmath.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;axsdk/axptz.h&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define APP_NAME &quot;axptzApp&quot;</span></div><div class="line"></div><div class="line"><span class="comment">/* This activates logging to syslog */</span></div><div class="line"><span class="preprocessor">#define WRITE_TO_SYS_LOG</span></div><div class="line"></div><div class="line"><span class="preprocessor">#ifdef WRITE_TO_SYS_LOG</span></div><div class="line"><span class="preprocessor">#define LOGINFO(fmt, args...) \</span></div><div class="line"><span class="preprocessor">  do { \</span></div><div class="line"><span class="preprocessor">    syslog(LOG_INFO, fmt, ## args); \</span></div><div class="line"><span class="preprocessor">    printf(fmt, ## args); \</span></div><div class="line"><span class="preprocessor">    printf(&quot;\n&quot;); \</span></div><div class="line"><span class="preprocessor">  } while(0)</span></div><div class="line"><span class="preprocessor">#else</span></div><div class="line"><span class="preprocessor">#define LOGINFO(fmt, args...)</span></div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line"><span class="comment">/* The number of fractional bits used in fix-point variables */</span></div><div class="line"><span class="preprocessor">#define FIXMATH_FRAC_BITS 16</span></div><div class="line"></div><div class="line"><span class="comment">/* global variables */</span></div><div class="line"><span class="keyword">static</span> <a name="_a0"></a><a class="code" href="struct__AXPTZControlQueueGroup.html">AXPTZControlQueueGroup</a> *ax_ptz_control_queue_group = NULL;</div><div class="line"><span class="keyword">static</span> gint video_channel = 1;</div><div class="line"><span class="keyword">static</span> gboolean camera_is_moving = FALSE;</div><div class="line"><span class="keyword">static</span> GList *capabilities = NULL;</div><div class="line"><span class="keyword">static</span> <a name="_a1"></a><a class="code" href="structAXPTZStatus.html">AXPTZStatus</a> *unitless_status = NULL;</div><div class="line"><span class="keyword">static</span> <a name="_a2"></a><a class="code" href="structAXPTZLimits.html">AXPTZLimits</a> *unitless_limits = NULL;</div><div class="line"><span class="keyword">static</span> <a class="code" href="structAXPTZLimits.html">AXPTZLimits</a> *unit_limits = NULL;</div><div class="line"></div><div class="line"><span class="keyword">static</span> fixed_t fx_zero = fx_itox(0, FIXMATH_FRAC_BITS);</div><div class="line"><span class="keyword">static</span> fixed_t fx_two = fx_ftox(2.0f, FIXMATH_FRAC_BITS);</div><div class="line"><span class="keyword">static</span> fixed_t fx_four = fx_ftox(4.0f, FIXMATH_FRAC_BITS);</div><div class="line"></div><div class="line"><span class="keyword">static</span> fixed_t unitless_low_pan = fx_itox(0, FIXMATH_FRAC_BITS);</div><div class="line"><span class="keyword">static</span> fixed_t unitless_centre_pan = fx_itox(0, FIXMATH_FRAC_BITS);</div><div class="line"><span class="keyword">static</span> fixed_t unitless_high_pan = fx_itox(0, FIXMATH_FRAC_BITS);</div><div class="line"><span class="keyword">static</span> fixed_t unitless_low_tilt = fx_itox(0, FIXMATH_FRAC_BITS);</div><div class="line"><span class="keyword">static</span> fixed_t unitless_centre_tilt = fx_itox(0, FIXMATH_FRAC_BITS);</div><div class="line"><span class="keyword">static</span> fixed_t unitless_high_tilt = fx_itox(0, FIXMATH_FRAC_BITS);</div><div class="line"><span class="keyword">static</span> fixed_t unitless_centre_zoom = fx_itox(0, FIXMATH_FRAC_BITS);</div><div class="line"></div><div class="line"><span class="keyword">static</span> fixed_t unit_low_pan = fx_itox(0, FIXMATH_FRAC_BITS);</div><div class="line"><span class="keyword">static</span> fixed_t unit_centre_pan = fx_itox(0, FIXMATH_FRAC_BITS);</div><div class="line"><span class="keyword">static</span> fixed_t unit_high_pan = fx_itox(0, FIXMATH_FRAC_BITS);</div><div class="line"><span class="keyword">static</span> fixed_t unit_low_tilt = fx_itox(0, FIXMATH_FRAC_BITS);</div><div class="line"><span class="keyword">static</span> fixed_t unit_centre_tilt = fx_itox(0, FIXMATH_FRAC_BITS);</div><div class="line"><span class="keyword">static</span> fixed_t unit_high_tilt = fx_itox(0, FIXMATH_FRAC_BITS);</div><div class="line"><span class="keyword">static</span> fixed_t unit_centre_zoom = fx_itox(0, FIXMATH_FRAC_BITS);</div><div class="line"></div><div class="line"><span class="keyword">static</span> fixed_t unitless_pos_speed = fx_ftox(0.25f, FIXMATH_FRAC_BITS);</div><div class="line"></div><div class="line"><span class="keyword">static</span> fixed_t unitless_chosen_pan_position = fx_itox(0, FIXMATH_FRAC_BITS);</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * Get the camera&#39;s supported PTZ move capabilities</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">static</span> gboolean get_ptz_move_capabilities(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">  GError *local_error = NULL;</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (!(capabilities =</div><div class="line">       <a name="a3"></a><a class="code" href="ax__ptz__movement__handler_8h.html#a3bbe5834af5ff7c9bd528441ba3c88a7">ax_ptz_movement_handler_get_move_capabilities</a>(video_channel,</div><div class="line">                                                     &amp;local_error))) {</div><div class="line">    g_error_free(local_error);</div><div class="line">    <span class="keywordflow">return</span> FALSE;</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> TRUE;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * Check if a capability is supported</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">static</span> gboolean is_capability_supported(<span class="keyword">const</span> <span class="keywordtype">char</span> *capability)</div><div class="line">{</div><div class="line">  gboolean is_supported = FALSE;</div><div class="line">  GList *it = NULL;</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (capabilities) {</div><div class="line">    <span class="keywordflow">for</span> (it = g_list_first(capabilities); it != NULL; it = g_list_next(it)) {</div><div class="line">      <span class="keywordflow">if</span> (!(g_strcmp0((gchar *) it-&gt;data, capability))) {</div><div class="line">        is_supported = TRUE;</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">      }</div><div class="line">    }</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> is_supported;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * Wait for the camera to reach it&#39;s position</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">static</span> gboolean wait_for_camera_movement_to_finish(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">  gboolean is_moving = TRUE;</div><div class="line">  gushort timer = 0;</div><div class="line">  gushort timeout = 10;</div><div class="line">  gushort sleep_time = 1;</div><div class="line">  GError *local_error = NULL;</div><div class="line"></div><div class="line">  <span class="comment">/* Check if camera is moving */</span></div><div class="line">  <span class="keywordflow">if</span> (!(<a name="a4"></a><a class="code" href="ax__ptz__movement__handler_8h.html#af5259e3586d5358f4991bf3952f582e8">ax_ptz_movement_handler_is_ptz_moving</a></div><div class="line">       (video_channel, &amp;is_moving, &amp;local_error))) {</div><div class="line">    g_error_free(local_error);</div><div class="line">    <span class="keywordflow">return</span> FALSE;</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">/* Wait until camera is in position or until we get a timeout */</span></div><div class="line">  <span class="keywordflow">while</span> (is_moving &amp;&amp; (timer &lt; timeout)) {</div><div class="line">    <span class="keywordflow">if</span> (!(<a class="code" href="ax__ptz__movement__handler_8h.html#af5259e3586d5358f4991bf3952f582e8">ax_ptz_movement_handler_is_ptz_moving</a></div><div class="line">         (video_channel, &amp;is_moving, &amp;local_error))) {</div><div class="line">      g_error_free(local_error);</div><div class="line">      <span class="keywordflow">return</span> FALSE;</div><div class="line">    }</div><div class="line"></div><div class="line">    sleep(sleep_time);</div><div class="line">    timer++;</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (is_moving) {</div><div class="line">    <span class="comment">/* Camera is still moving */</span></div><div class="line">    <span class="keywordflow">return</span> FALSE;</div><div class="line">  } <span class="keywordflow">else</span> {</div><div class="line">    <span class="comment">/* Camera is in position */</span></div><div class="line">    <span class="keywordflow">return</span> TRUE;</div><div class="line">  }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * Perform camera movement to absolute position</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">static</span> gboolean</div><div class="line">move_to_absolute_position(fixed_t pan_value,</div><div class="line">                          fixed_t tilt_value,</div><div class="line">                          <a class="code" href="ax__ptz__movement__handler_8h.html#acdb1f9542dd4406117dc2b1991605deb">AXPTZMovementPanTiltSpace</a> pan_tilt_space,</div><div class="line">                          gfloat speed,</div><div class="line">                          <a class="code" href="ax__ptz__movement__handler_8h.html#ac1f5dce620a163b9ef64bed56eeaae25">AXPTZMovementPanTiltSpeedSpace</a> pan_tilt_speed_space,</div><div class="line">                          fixed_t zoom_value, <a class="code" href="ax__ptz__movement__handler_8h.html#a28777972e354c28515d4fe8b944183f7">AXPTZMovementZoomSpace</a> zoom_space)</div><div class="line">{</div><div class="line">  <a name="_a5"></a><a class="code" href="struct__AXPTZAbsoluteMovement.html">AXPTZAbsoluteMovement</a> *abs_movement = NULL;</div><div class="line">  GError *local_error = NULL;</div><div class="line"></div><div class="line">  <span class="comment">/* Set the unit spaces for an absolute movement */</span></div><div class="line">  <span class="keywordflow">if</span> ((<a name="a6"></a><a class="code" href="ax__ptz__movement__handler_8h.html#a5c053ea312ea00e93d7129efbeb9162f">ax_ptz_movement_handler_set_absolute_spaces</a></div><div class="line">       (pan_tilt_space, pan_tilt_speed_space, zoom_space, &amp;local_error))) {</div><div class="line">    <span class="comment">/* Create an absolute movement structure */</span></div><div class="line">    <span class="keywordflow">if</span> ((abs_movement = <a name="a7"></a><a class="code" href="ax__ptz__movement_8h.html#a1c9e319b80fa67d7938c6d9bb933f0ad">ax_ptz_absolute_movement_create</a>(&amp;local_error))) {</div><div class="line"></div><div class="line">      <span class="comment">/* Set the pan, tilt and zoom values for the absolute movement */</span></div><div class="line">      <span class="keywordflow">if</span> (!(<a name="a8"></a><a class="code" href="ax__ptz__movement_8h.html#a33c5e9d93ccb3723e2e0ce28b1218efc">ax_ptz_absolute_movement_set_pan_tilt_zoom</a>(abs_movement,</div><div class="line">                                                       pan_value,</div><div class="line">                                                       tilt_value,</div><div class="line">                                                       fx_ftox(speed,</div><div class="line">                                                               FIXMATH_FRAC_BITS),</div><div class="line">                                                       zoom_value,</div><div class="line">                                                       AX_PTZ_MOVEMENT_NO_VALUE,</div><div class="line">                                                       &amp;local_error))) {</div><div class="line">        <a name="a9"></a><a class="code" href="ax__ptz__movement_8h.html#a7424655eb466bd807047d07b1f61e5ee">ax_ptz_absolute_movement_destroy</a>(abs_movement, NULL);</div><div class="line">        g_error_free(local_error);</div><div class="line">        <span class="keywordflow">return</span> FALSE;</div><div class="line">      }</div><div class="line"></div><div class="line">      <span class="comment">/* Perform the absolute movement */</span></div><div class="line">      <span class="keywordflow">if</span> (!(<a name="a10"></a><a class="code" href="ax__ptz__movement__handler_8h.html#acd43d5f396fdbf85b0c17ec0f2e9ae64">ax_ptz_movement_handler_absolute_move</a>(ax_ptz_control_queue_group,</div><div class="line">                                                  video_channel,</div><div class="line">                                                  abs_movement,</div><div class="line">                                                  <a name="a11"></a><a class="code" href="ax__ptz__types_8h.html#a369cd74684ba8a67304ff2f05d8456dcaa1883c21d55bbcf3b69030005566b2d7">AX_PTZ_INVOKE_ASYNC</a>, NULL,</div><div class="line">                                                  NULL, &amp;local_error))) {</div><div class="line">        <a class="code" href="ax__ptz__movement_8h.html#a7424655eb466bd807047d07b1f61e5ee">ax_ptz_absolute_movement_destroy</a>(abs_movement, NULL);</div><div class="line">        g_error_free(local_error);</div><div class="line">        <span class="keywordflow">return</span> FALSE;</div><div class="line">      }</div><div class="line"></div><div class="line">      <span class="comment">/* Now we don&#39;t need the absolute movement structure anymore, destroy it */</span></div><div class="line">      <span class="keywordflow">if</span> (!(<a class="code" href="ax__ptz__movement_8h.html#a7424655eb466bd807047d07b1f61e5ee">ax_ptz_absolute_movement_destroy</a>(abs_movement, &amp;local_error))) {</div><div class="line">        g_error_free(local_error);</div><div class="line">        <span class="keywordflow">return</span> FALSE;</div><div class="line">      }</div><div class="line">    } <span class="keywordflow">else</span> {</div><div class="line">      g_error_free(local_error);</div><div class="line">      <span class="keywordflow">return</span> FALSE;</div><div class="line">    }</div><div class="line">  } <span class="keywordflow">else</span> {</div><div class="line">    g_error_free(local_error);</div><div class="line">    <span class="keywordflow">return</span> FALSE;</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> TRUE;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * Perform camera movement to relative position</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">static</span> gboolean</div><div class="line">move_to_relative_position(fixed_t pan_value,</div><div class="line">                          fixed_t tilt_value,</div><div class="line">                          <a class="code" href="ax__ptz__movement__handler_8h.html#acdb1f9542dd4406117dc2b1991605deb">AXPTZMovementPanTiltSpace</a> pan_tilt_space,</div><div class="line">                          gfloat speed,</div><div class="line">                          <a class="code" href="ax__ptz__movement__handler_8h.html#ac1f5dce620a163b9ef64bed56eeaae25">AXPTZMovementPanTiltSpeedSpace</a> pan_tilt_speed_space,</div><div class="line">                          fixed_t zoom_value, <a class="code" href="ax__ptz__movement__handler_8h.html#a28777972e354c28515d4fe8b944183f7">AXPTZMovementZoomSpace</a> zoom_space)</div><div class="line">{</div><div class="line">  <a name="_a12"></a><a class="code" href="struct__AXPTZRelativeMovement.html">AXPTZRelativeMovement</a> *rel_movement = NULL;</div><div class="line">  GError *local_error = NULL;</div><div class="line"></div><div class="line">  <span class="comment">/* Set the unit spaces for a relative movement */</span></div><div class="line">  <span class="keywordflow">if</span> ((<a name="a13"></a><a class="code" href="ax__ptz__movement__handler_8h.html#ab1efe9572bbda26dd34db787e71f1c67">ax_ptz_movement_handler_set_relative_spaces</a></div><div class="line">       (pan_tilt_space, pan_tilt_speed_space, zoom_space, &amp;local_error))) {</div><div class="line"></div><div class="line">    <span class="comment">/* Create a relative movement structure */</span></div><div class="line">    <span class="keywordflow">if</span> ((rel_movement = <a name="a14"></a><a class="code" href="ax__ptz__movement_8h.html#a94556843fe40890ee1ead7838d4165f2">ax_ptz_relative_movement_create</a>(&amp;local_error))) {</div><div class="line"></div><div class="line">      <span class="comment">/* Set the pan, tilt and zoom values for the relative movement */</span></div><div class="line">      <span class="keywordflow">if</span> (!(<a name="a15"></a><a class="code" href="ax__ptz__movement_8h.html#a0328bdc767a0fe1acdce42750deb5b53">ax_ptz_relative_movement_set_pan_tilt_zoom</a>(rel_movement,</div><div class="line">                                                       pan_value,</div><div class="line">                                                       tilt_value,</div><div class="line">                                                       fx_ftox(speed, FIXMATH_FRAC_BITS),</div><div class="line">                                                       zoom_value,</div><div class="line">                                                       AX_PTZ_MOVEMENT_NO_VALUE,</div><div class="line">                                                       &amp;local_error))) {</div><div class="line">        <a name="a16"></a><a class="code" href="ax__ptz__movement_8h.html#ae5e16272fc54b542fab24db44d02fc91">ax_ptz_relative_movement_destroy</a>(rel_movement, NULL);</div><div class="line">        g_error_free(local_error);</div><div class="line">        <span class="keywordflow">return</span> FALSE;</div><div class="line">      }</div><div class="line"></div><div class="line">      <span class="comment">/* Perform the relative movement */</span></div><div class="line">      <span class="keywordflow">if</span> (!(<a name="a17"></a><a class="code" href="ax__ptz__movement__handler_8h.html#a2f58138d21c3e4e4fa3666a309489c5a">ax_ptz_movement_handler_relative_move</a>(ax_ptz_control_queue_group,</div><div class="line">                                                  video_channel,</div><div class="line">                                                  rel_movement,</div><div class="line">                                                  <a class="code" href="ax__ptz__types_8h.html#a369cd74684ba8a67304ff2f05d8456dcaa1883c21d55bbcf3b69030005566b2d7">AX_PTZ_INVOKE_ASYNC</a>, NULL,</div><div class="line">                                                  NULL, &amp;local_error))) {</div><div class="line">        <a class="code" href="ax__ptz__movement_8h.html#ae5e16272fc54b542fab24db44d02fc91">ax_ptz_relative_movement_destroy</a>(rel_movement, NULL);</div><div class="line">        g_error_free(local_error);</div><div class="line">        <span class="keywordflow">return</span> FALSE;</div><div class="line">      }</div><div class="line"></div><div class="line">      <span class="comment">/* Now we don&#39;t need the relative movement structure anymore, destroy it */</span></div><div class="line">      <span class="keywordflow">if</span> (!(<a class="code" href="ax__ptz__movement_8h.html#ae5e16272fc54b542fab24db44d02fc91">ax_ptz_relative_movement_destroy</a>(rel_movement, &amp;local_error))) {</div><div class="line">        g_error_free(local_error);</div><div class="line">        <span class="keywordflow">return</span> FALSE;</div><div class="line">      }</div><div class="line">    } <span class="keywordflow">else</span> {</div><div class="line">      g_error_free(local_error);</div><div class="line">      <span class="keywordflow">return</span> FALSE;</div><div class="line">    }</div><div class="line">  } <span class="keywordflow">else</span> {</div><div class="line">    g_error_free(local_error);</div><div class="line">    <span class="keywordflow">return</span> FALSE;</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> TRUE;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * Perform continous camera movement</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">static</span> gboolean</div><div class="line">start_continous_movement(fixed_t pan_speed,</div><div class="line">                         fixed_t tilt_speed,</div><div class="line">                         <a class="code" href="ax__ptz__movement__handler_8h.html#ac1f5dce620a163b9ef64bed56eeaae25">AXPTZMovementPanTiltSpeedSpace</a> pan_tilt_speed_space,</div><div class="line">                         fixed_t zoom_speed, gfloat timeout)</div><div class="line">{</div><div class="line">  <a name="_a18"></a><a class="code" href="struct__AXPTZContinuousMovement.html">AXPTZContinuousMovement</a> *cont_movement = NULL;</div><div class="line">  GError *local_error = NULL;</div><div class="line"></div><div class="line">  <span class="comment">/* Set the unit spaces for a continous movement */</span></div><div class="line">  <span class="keywordflow">if</span> ((<a name="a19"></a><a class="code" href="ax__ptz__movement__handler_8h.html#a0ba85730c9d78f54a7733e2b8836b7a1">ax_ptz_movement_handler_set_continuous_spaces</a></div><div class="line">       (pan_tilt_speed_space, &amp;local_error))) {</div><div class="line"></div><div class="line">    <span class="comment">/* Create a continous movement structure */</span></div><div class="line">    <span class="keywordflow">if</span> ((cont_movement = <a name="a20"></a><a class="code" href="ax__ptz__movement_8h.html#a8659d8b14382acfdddb7eb31583d5a7e">ax_ptz_continuous_movement_create</a>(&amp;local_error))) {</div><div class="line"></div><div class="line">      <span class="comment">/* Set the pan, tilt and zoom speeds for the continous movement */</span></div><div class="line">      <span class="keywordflow">if</span> (!(<a name="a21"></a><a class="code" href="ax__ptz__movement_8h.html#aed73bbeda3a941a5d6dd99936bbc56a1">ax_ptz_continuous_movement_set_pan_tilt_zoom</a>(cont_movement,</div><div class="line">                                                         pan_speed,</div><div class="line">                                                         tilt_speed,</div><div class="line">                                                         zoom_speed,</div><div class="line">                                                         fx_ftox(timeout, FIXMATH_FRAC_BITS),</div><div class="line">                                                         &amp;local_error))) {</div><div class="line">        <a name="a22"></a><a class="code" href="ax__ptz__movement_8h.html#ac888dde94a0a2b5a7f88ba6868c90fa6">ax_ptz_continuous_movement_destroy</a>(cont_movement, NULL);</div><div class="line">        g_error_free(local_error);</div><div class="line">        <span class="keywordflow">return</span> FALSE;</div><div class="line">      }</div><div class="line"></div><div class="line">      <span class="comment">/* Perform the continous movement */</span></div><div class="line">      <span class="keywordflow">if</span> (!(<a name="a23"></a><a class="code" href="ax__ptz__movement__handler_8h.html#a431ad80ff68bfbc0a850c85e5d4d8d35">ax_ptz_movement_handler_continuous_start</a>(ax_ptz_control_queue_group,</div><div class="line">                                                     video_channel,</div><div class="line">                                                     cont_movement,</div><div class="line">                                                     <a class="code" href="ax__ptz__types_8h.html#a369cd74684ba8a67304ff2f05d8456dcaa1883c21d55bbcf3b69030005566b2d7">AX_PTZ_INVOKE_ASYNC</a>, NULL,</div><div class="line">                                                     NULL, &amp;local_error))) {</div><div class="line">        <a class="code" href="ax__ptz__movement_8h.html#ac888dde94a0a2b5a7f88ba6868c90fa6">ax_ptz_continuous_movement_destroy</a>(cont_movement, NULL);</div><div class="line">        g_error_free(local_error);</div><div class="line">        <span class="keywordflow">return</span> FALSE;</div><div class="line">      }</div><div class="line"></div><div class="line">      <span class="comment">/* Now we don&#39;t need the continous movement structure anymore, destroy it */</span></div><div class="line">      <span class="keywordflow">if</span> (!(<a class="code" href="ax__ptz__movement_8h.html#ac888dde94a0a2b5a7f88ba6868c90fa6">ax_ptz_continuous_movement_destroy</a>(cont_movement, &amp;local_error))) {</div><div class="line">        g_error_free(local_error);</div><div class="line">        <span class="keywordflow">return</span> FALSE;</div><div class="line">      }</div><div class="line">    } <span class="keywordflow">else</span> {</div><div class="line">      g_error_free(local_error);</div><div class="line">      <span class="keywordflow">return</span> FALSE;</div><div class="line">    }</div><div class="line">  } <span class="keywordflow">else</span> {</div><div class="line">    g_error_free(local_error);</div><div class="line">    <span class="keywordflow">return</span> FALSE;</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> TRUE;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * Stop continous camera movement</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">static</span> gboolean stop_continous_movement(gboolean stop_pan_tilt,</div><div class="line">                                        gboolean stop_zoom)</div><div class="line">{</div><div class="line">  GError *local_error = NULL;</div><div class="line"></div><div class="line">  <span class="comment">/* Stop the continous movement */</span></div><div class="line">  <span class="keywordflow">if</span> (!(<a name="a24"></a><a class="code" href="ax__ptz__movement__handler_8h.html#a7359f9cccbce70afbceeebf8b8702c04">ax_ptz_movement_handler_continuous_stop</a>(ax_ptz_control_queue_group,</div><div class="line">                                                video_channel,</div><div class="line">                                                stop_pan_tilt,</div><div class="line">                                                stop_zoom, <a class="code" href="ax__ptz__types_8h.html#a369cd74684ba8a67304ff2f05d8456dcaa1883c21d55bbcf3b69030005566b2d7">AX_PTZ_INVOKE_ASYNC</a>,</div><div class="line">                                                NULL, NULL, &amp;local_error))) {</div><div class="line">    g_error_free(local_error);</div><div class="line">    <span class="keywordflow">return</span> FALSE;</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> TRUE;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * Main</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div><div class="line">{</div><div class="line">  GList *it = NULL;</div><div class="line">  gint preset_number_0 = -1;</div><div class="line">  gint preset_number_1 = -1;</div><div class="line">  gint queue_pos = -1;</div><div class="line">  gint time_to_pos_one = -1;</div><div class="line">  gint poll_time = -1;</div><div class="line">  GError *local_error = NULL;</div><div class="line"></div><div class="line"><span class="preprocessor">#ifdef WRITE_TO_SYS_LOG</span></div><div class="line">  openlog(APP_NAME, LOG_PID | LOG_CONS, LOG_USER);</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">  LOGINFO(<span class="stringliteral">&quot;\&#39;axptz library\&#39; example application started...\n&quot;</span>);</div><div class="line"></div><div class="line">  <span class="comment">/* Create the axptz library */</span></div><div class="line">  <span class="keywordflow">if</span> (!(<a name="a25"></a><a class="code" href="ax__ptz_8h.html#a5fc1362bb2f0802479ff6260f086f7f6">ax_ptz_create</a>(&amp;local_error))) {</div><div class="line">    <span class="keywordflow">goto</span> failure;</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">/* Get the application group from the PTZ control queue */</span></div><div class="line">  <span class="keywordflow">if</span> (!(ax_ptz_control_queue_group =</div><div class="line">       <a name="a26"></a><a class="code" href="ax__ptz__control__queue_8h.html#a0a947fbcab7c23b577eaefdf9b6fa533">ax_ptz_control_queue_get_app_group_instance</a>(&amp;local_error))) {</div><div class="line">    <span class="keywordflow">goto</span> failure;</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">/* Get the supported capabilities */</span></div><div class="line">  <span class="keywordflow">if</span> (!(get_ptz_move_capabilities())) {</div><div class="line">    <span class="keywordflow">goto</span> failure;</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">/* Get the current status (e.g. the current pan/tilt/zoom value/position) */</span></div><div class="line">  <span class="keywordflow">if</span> (!(<a name="a27"></a><a class="code" href="ax__ptz__movement__handler_8h.html#ac0c57225f171fc5a1399d456eed4e0e1">ax_ptz_movement_handler_get_ptz_status</a>(video_channel,</div><div class="line">                                               <a name="a28"></a><a class="code" href="ax__ptz__movement__handler_8h.html#acdb1f9542dd4406117dc2b1991605debaf4593175d0426d8582f543891c300c79">AX_PTZ_MOVEMENT_PAN_TILT_UNITLESS</a>,</div><div class="line">                                               <a name="a29"></a><a class="code" href="ax__ptz__movement__handler_8h.html#a28777972e354c28515d4fe8b944183f7aad2b21bd7f932ccf89decdc7f3f59535">AX_PTZ_MOVEMENT_ZOOM_UNITLESS</a>,</div><div class="line">                                               &amp;unitless_status,</div><div class="line">                                               &amp;local_error))) {</div><div class="line">    <span class="keywordflow">goto</span> failure;</div><div class="line">  }</div><div class="line"></div><div class="line">  LOGINFO(<span class="stringliteral">&quot;Now we got the current PTZ status.\n&quot;</span>);</div><div class="line"></div><div class="line">  <span class="comment">/* Get the pan, tilt and zoom limits for the unitless space */</span></div><div class="line">  <span class="keywordflow">if</span> ((<a name="a30"></a><a class="code" href="ax__ptz__movement__handler_8h.html#a89a2efb4e2957b05eb3ca8dca7799d50">ax_ptz_movement_handler_get_ptz_limits</a>(video_channel,</div><div class="line">                                              <a class="code" href="ax__ptz__movement__handler_8h.html#acdb1f9542dd4406117dc2b1991605debaf4593175d0426d8582f543891c300c79">AX_PTZ_MOVEMENT_PAN_TILT_UNITLESS</a>,</div><div class="line">                                              <a class="code" href="ax__ptz__movement__handler_8h.html#a28777972e354c28515d4fe8b944183f7aad2b21bd7f932ccf89decdc7f3f59535">AX_PTZ_MOVEMENT_ZOOM_UNITLESS</a>,</div><div class="line">                                              &amp;unitless_limits,</div><div class="line">                                              &amp;local_error))) {</div><div class="line">    unitless_low_pan =</div><div class="line">        fx_addx(fx_divx</div><div class="line">                (fx_subx</div><div class="line">                 (unitless_limits-&gt;<a name="a31"></a><a class="code" href="structAXPTZLimits.html#af9fdf870bbb2dbfbf6ab7835f476573e">max_pan_value</a>,</div><div class="line">                  unitless_limits-&gt;<a name="a32"></a><a class="code" href="structAXPTZLimits.html#a00fdcb7c7316e04cad7219af99260d64">min_pan_value</a>), fx_four, FIXMATH_FRAC_BITS),</div><div class="line">                unitless_limits-&gt;<a class="code" href="structAXPTZLimits.html#a00fdcb7c7316e04cad7219af99260d64">min_pan_value</a>);</div><div class="line">    unitless_centre_pan =</div><div class="line">        fx_addx(fx_divx</div><div class="line">                (fx_subx</div><div class="line">                 (unitless_limits-&gt;<a class="code" href="structAXPTZLimits.html#af9fdf870bbb2dbfbf6ab7835f476573e">max_pan_value</a>,</div><div class="line">                  unitless_limits-&gt;<a class="code" href="structAXPTZLimits.html#a00fdcb7c7316e04cad7219af99260d64">min_pan_value</a>), fx_two, FIXMATH_FRAC_BITS),</div><div class="line">                unitless_limits-&gt;<a class="code" href="structAXPTZLimits.html#a00fdcb7c7316e04cad7219af99260d64">min_pan_value</a>);</div><div class="line">    unitless_high_pan =</div><div class="line">        fx_subx(unitless_limits-&gt;<a class="code" href="structAXPTZLimits.html#af9fdf870bbb2dbfbf6ab7835f476573e">max_pan_value</a>,</div><div class="line">                fx_divx(fx_subx</div><div class="line">                        (unitless_limits-&gt;<a class="code" href="structAXPTZLimits.html#af9fdf870bbb2dbfbf6ab7835f476573e">max_pan_value</a>,</div><div class="line">                         unitless_limits-&gt;<a class="code" href="structAXPTZLimits.html#a00fdcb7c7316e04cad7219af99260d64">min_pan_value</a>), fx_four,</div><div class="line">                        FIXMATH_FRAC_BITS));</div><div class="line">    unitless_low_tilt =</div><div class="line">        fx_addx(fx_divx</div><div class="line">                (fx_subx</div><div class="line">                 (unitless_limits-&gt;<a name="a33"></a><a class="code" href="structAXPTZLimits.html#a655a7bce0af4f3374ea879bc3ad03539">max_tilt_value</a>,</div><div class="line">                  unitless_limits-&gt;<a name="a34"></a><a class="code" href="structAXPTZLimits.html#a620394756278e42ee77c3ccc6731e99a">min_tilt_value</a>), fx_four, FIXMATH_FRAC_BITS),</div><div class="line">                unitless_limits-&gt;<a class="code" href="structAXPTZLimits.html#a620394756278e42ee77c3ccc6731e99a">min_tilt_value</a>);</div><div class="line">    unitless_centre_tilt =</div><div class="line">        fx_addx(fx_divx</div><div class="line">                (fx_subx</div><div class="line">                 (unitless_limits-&gt;<a class="code" href="structAXPTZLimits.html#a655a7bce0af4f3374ea879bc3ad03539">max_tilt_value</a>,</div><div class="line">                  unitless_limits-&gt;<a class="code" href="structAXPTZLimits.html#a620394756278e42ee77c3ccc6731e99a">min_tilt_value</a>), fx_two, FIXMATH_FRAC_BITS),</div><div class="line">                unitless_limits-&gt;<a class="code" href="structAXPTZLimits.html#a620394756278e42ee77c3ccc6731e99a">min_tilt_value</a>);</div><div class="line">    unitless_high_tilt =</div><div class="line">        fx_subx(unitless_limits-&gt;<a class="code" href="structAXPTZLimits.html#a655a7bce0af4f3374ea879bc3ad03539">max_tilt_value</a>,</div><div class="line">                fx_divx(fx_subx</div><div class="line">                        (unitless_limits-&gt;<a class="code" href="structAXPTZLimits.html#a655a7bce0af4f3374ea879bc3ad03539">max_tilt_value</a>,</div><div class="line">                         unitless_limits-&gt;<a class="code" href="structAXPTZLimits.html#a620394756278e42ee77c3ccc6731e99a">min_tilt_value</a>), fx_two,</div><div class="line">                        FIXMATH_FRAC_BITS));</div><div class="line">    unitless_centre_zoom =</div><div class="line">        fx_addx(fx_divx</div><div class="line">                (fx_subx</div><div class="line">                 (unitless_limits-&gt;<a name="a35"></a><a class="code" href="structAXPTZLimits.html#a30be40c97f0190b4185f05833aab5d1b">max_zoom_value</a>,</div><div class="line">                  unitless_limits-&gt;<a name="a36"></a><a class="code" href="structAXPTZLimits.html#a8941f2b31e9642ab5e41b247ead25503">min_zoom_value</a>), fx_two, FIXMATH_FRAC_BITS),</div><div class="line">                unitless_limits-&gt;<a class="code" href="structAXPTZLimits.html#a8941f2b31e9642ab5e41b247ead25503">min_zoom_value</a>);</div><div class="line">  } <span class="keywordflow">else</span> {</div><div class="line">    <span class="keywordflow">goto</span> failure;</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">/* Get the pan, tilt and zoom limits for the unit (degrees) space */</span></div><div class="line">  <span class="keywordflow">if</span> ((<a class="code" href="ax__ptz__movement__handler_8h.html#a89a2efb4e2957b05eb3ca8dca7799d50">ax_ptz_movement_handler_get_ptz_limits</a>(video_channel,</div><div class="line">                                              <a name="a37"></a><a class="code" href="ax__ptz__movement__handler_8h.html#acdb1f9542dd4406117dc2b1991605deba25179731b702edb812046c3ea14b3238">AX_PTZ_MOVEMENT_PAN_TILT_DEGREE</a>,</div><div class="line">                                              <a class="code" href="ax__ptz__movement__handler_8h.html#a28777972e354c28515d4fe8b944183f7aad2b21bd7f932ccf89decdc7f3f59535">AX_PTZ_MOVEMENT_ZOOM_UNITLESS</a>,</div><div class="line">                                              &amp;unit_limits, &amp;local_error))) {</div><div class="line">    unit_low_pan =</div><div class="line">        fx_addx(fx_divx</div><div class="line">                (fx_subx</div><div class="line">                 (unit_limits-&gt;<a class="code" href="structAXPTZLimits.html#af9fdf870bbb2dbfbf6ab7835f476573e">max_pan_value</a>, unit_limits-&gt;<a class="code" href="structAXPTZLimits.html#a00fdcb7c7316e04cad7219af99260d64">min_pan_value</a>),</div><div class="line">                 fx_four, FIXMATH_FRAC_BITS), unit_limits-&gt;<a class="code" href="structAXPTZLimits.html#a00fdcb7c7316e04cad7219af99260d64">min_pan_value</a>);</div><div class="line">    unit_centre_pan =</div><div class="line">        fx_addx(fx_divx</div><div class="line">                (fx_subx</div><div class="line">                 (unit_limits-&gt;<a class="code" href="structAXPTZLimits.html#af9fdf870bbb2dbfbf6ab7835f476573e">max_pan_value</a>, unit_limits-&gt;<a class="code" href="structAXPTZLimits.html#a00fdcb7c7316e04cad7219af99260d64">min_pan_value</a>),</div><div class="line">                 fx_two, FIXMATH_FRAC_BITS), unit_limits-&gt;<a class="code" href="structAXPTZLimits.html#a00fdcb7c7316e04cad7219af99260d64">min_pan_value</a>);</div><div class="line">    unit_high_pan =</div><div class="line">        fx_subx(unit_limits-&gt;<a class="code" href="structAXPTZLimits.html#af9fdf870bbb2dbfbf6ab7835f476573e">max_pan_value</a>,</div><div class="line">                fx_divx(fx_subx</div><div class="line">                        (unit_limits-&gt;<a class="code" href="structAXPTZLimits.html#af9fdf870bbb2dbfbf6ab7835f476573e">max_pan_value</a>,</div><div class="line">                         unit_limits-&gt;<a class="code" href="structAXPTZLimits.html#a00fdcb7c7316e04cad7219af99260d64">min_pan_value</a>), fx_four,</div><div class="line">                        FIXMATH_FRAC_BITS));</div><div class="line">    unit_low_tilt =</div><div class="line">        fx_addx(fx_divx</div><div class="line">                (fx_subx</div><div class="line">                 (unit_limits-&gt;<a class="code" href="structAXPTZLimits.html#a655a7bce0af4f3374ea879bc3ad03539">max_tilt_value</a>, unit_limits-&gt;<a class="code" href="structAXPTZLimits.html#a620394756278e42ee77c3ccc6731e99a">min_tilt_value</a>),</div><div class="line">                 fx_four, FIXMATH_FRAC_BITS), unit_limits-&gt;<a class="code" href="structAXPTZLimits.html#a620394756278e42ee77c3ccc6731e99a">min_tilt_value</a>);</div><div class="line">    unit_centre_tilt =</div><div class="line">        fx_addx(fx_divx</div><div class="line">                (fx_subx</div><div class="line">                 (unit_limits-&gt;<a class="code" href="structAXPTZLimits.html#a655a7bce0af4f3374ea879bc3ad03539">max_tilt_value</a>, unit_limits-&gt;<a class="code" href="structAXPTZLimits.html#a620394756278e42ee77c3ccc6731e99a">min_tilt_value</a>),</div><div class="line">                 fx_two, FIXMATH_FRAC_BITS), unit_limits-&gt;<a class="code" href="structAXPTZLimits.html#a620394756278e42ee77c3ccc6731e99a">min_tilt_value</a>);</div><div class="line">    unit_high_tilt =</div><div class="line">        fx_subx(unit_limits-&gt;<a class="code" href="structAXPTZLimits.html#a655a7bce0af4f3374ea879bc3ad03539">max_tilt_value</a>,</div><div class="line">                fx_divx(fx_subx</div><div class="line">                        (unit_limits-&gt;<a class="code" href="structAXPTZLimits.html#a655a7bce0af4f3374ea879bc3ad03539">max_tilt_value</a>,</div><div class="line">                         unit_limits-&gt;<a class="code" href="structAXPTZLimits.html#a620394756278e42ee77c3ccc6731e99a">min_tilt_value</a>), fx_four,</div><div class="line">                        FIXMATH_FRAC_BITS));</div><div class="line">    unit_centre_zoom =</div><div class="line">        fx_addx(fx_divx</div><div class="line">                (fx_subx</div><div class="line">                 (unit_limits-&gt;<a class="code" href="structAXPTZLimits.html#a30be40c97f0190b4185f05833aab5d1b">max_zoom_value</a>, unit_limits-&gt;<a class="code" href="structAXPTZLimits.html#a8941f2b31e9642ab5e41b247ead25503">min_zoom_value</a>),</div><div class="line">                 fx_two, FIXMATH_FRAC_BITS), unit_limits-&gt;<a class="code" href="structAXPTZLimits.html#a8941f2b31e9642ab5e41b247ead25503">min_zoom_value</a>);</div><div class="line">  } <span class="keywordflow">else</span> {</div><div class="line">    <span class="keywordflow">goto</span> failure;</div><div class="line">  }</div><div class="line"></div><div class="line">  LOGINFO(<span class="stringliteral">&quot;Now we got the current PTZ limits.\n&quot;</span>);</div><div class="line"></div><div class="line">  <span class="comment">/* Verify that the &#39;absolute pan movement&#39; capability is supported */</span></div><div class="line">  <span class="keywordflow">if</span> ((is_capability_supported(<span class="stringliteral">&quot;AX_PTZ_MOVE_ABS_PAN&quot;</span>))) {</div><div class="line">    <span class="keywordflow">if</span> (!(move_to_absolute_position(unitless_centre_pan, AX_PTZ_MOVEMENT_NO_VALUE,</div><div class="line">                                    <a class="code" href="ax__ptz__movement__handler_8h.html#acdb1f9542dd4406117dc2b1991605debaf4593175d0426d8582f543891c300c79">AX_PTZ_MOVEMENT_PAN_TILT_UNITLESS</a>, 0.5f,</div><div class="line">                                    <a name="a38"></a><a class="code" href="ax__ptz__movement__handler_8h.html#ac1f5dce620a163b9ef64bed56eeaae25ac45c5415ba5f653faed82474daf6cf12">AX_PTZ_MOVEMENT_PAN_TILT_SPEED_UNITLESS</a>,</div><div class="line">                                    unitless_status-&gt;<a name="a39"></a><a class="code" href="structAXPTZStatus.html#af17a13fc878f41143630a46b6c9ee6af">zoom_value</a>,</div><div class="line">                                    <a class="code" href="ax__ptz__movement__handler_8h.html#a28777972e354c28515d4fe8b944183f7aad2b21bd7f932ccf89decdc7f3f59535">AX_PTZ_MOVEMENT_ZOOM_UNITLESS</a>))) {</div><div class="line">      <span class="keywordflow">goto</span> failure;</div><div class="line">    }</div><div class="line"></div><div class="line">    LOGINFO(<span class="stringliteral">&quot;Absolute movement to centre pan position.\n&quot;</span>);</div><div class="line"></div><div class="line">    <span class="comment">/* We wait for the camera ptz movement to finish */</span></div><div class="line">    <span class="keywordflow">if</span> (!(wait_for_camera_movement_to_finish())) {</div><div class="line">      <span class="keywordflow">goto</span> failure;</div><div class="line">    }</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">/* Verify that the &#39;relative pan movement&#39; capability is supported */</span></div><div class="line">  <span class="keywordflow">if</span> ((is_capability_supported(<span class="stringliteral">&quot;AX_PTZ_MOVE_REL_PAN&quot;</span>))) {</div><div class="line"></div><div class="line">    <span class="comment">/* Choose a pan position between the current</span></div><div class="line"><span class="comment">     * position (centre) and the high pan position</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    unitless_chosen_pan_position =</div><div class="line">        fx_divx((fx_subx(unitless_high_pan, unitless_centre_pan)), fx_two,</div><div class="line">                FIXMATH_FRAC_BITS);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (!(move_to_relative_position(unitless_chosen_pan_position,</div><div class="line">                                    AX_PTZ_MOVEMENT_NO_VALUE,</div><div class="line">                                    <a class="code" href="ax__ptz__movement__handler_8h.html#acdb1f9542dd4406117dc2b1991605debaf4593175d0426d8582f543891c300c79">AX_PTZ_MOVEMENT_PAN_TILT_UNITLESS</a>,</div><div class="line">                                    0.5f,</div><div class="line">                                    <a class="code" href="ax__ptz__movement__handler_8h.html#ac1f5dce620a163b9ef64bed56eeaae25ac45c5415ba5f653faed82474daf6cf12">AX_PTZ_MOVEMENT_PAN_TILT_SPEED_UNITLESS</a>,</div><div class="line">                                    unitless_status-&gt;<a class="code" href="structAXPTZStatus.html#af17a13fc878f41143630a46b6c9ee6af">zoom_value</a>,</div><div class="line">                                    <a class="code" href="ax__ptz__movement__handler_8h.html#a28777972e354c28515d4fe8b944183f7aad2b21bd7f932ccf89decdc7f3f59535">AX_PTZ_MOVEMENT_ZOOM_UNITLESS</a>))) {</div><div class="line">      <span class="keywordflow">goto</span> failure;</div><div class="line">    }</div><div class="line"></div><div class="line">    LOGINFO(<span class="stringliteral">&quot;Relative movement to chosen pan position.\n&quot;</span>);</div><div class="line"></div><div class="line">    <span class="comment">/* We wait for the camera ptz movement to finish */</span></div><div class="line">    <span class="keywordflow">if</span> (!(wait_for_camera_movement_to_finish())) {</div><div class="line">      <span class="keywordflow">goto</span> failure;</div><div class="line">    }</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">/* Verify that the &#39;absolute tilt movement&#39; capability is supported */</span></div><div class="line">  <span class="keywordflow">if</span> ((is_capability_supported(<span class="stringliteral">&quot;AX_PTZ_MOVE_ABS_TILT&quot;</span>))) {</div><div class="line">    <span class="keywordflow">if</span> (!(move_to_absolute_position(AX_PTZ_MOVEMENT_NO_VALUE,</div><div class="line">                                    unit_centre_tilt,</div><div class="line">                                    <a class="code" href="ax__ptz__movement__handler_8h.html#acdb1f9542dd4406117dc2b1991605deba25179731b702edb812046c3ea14b3238">AX_PTZ_MOVEMENT_PAN_TILT_DEGREE</a>,</div><div class="line">                                    0.5f,</div><div class="line">                                    <a class="code" href="ax__ptz__movement__handler_8h.html#ac1f5dce620a163b9ef64bed56eeaae25ac45c5415ba5f653faed82474daf6cf12">AX_PTZ_MOVEMENT_PAN_TILT_SPEED_UNITLESS</a>,</div><div class="line">                                    unitless_status-&gt;<a class="code" href="structAXPTZStatus.html#af17a13fc878f41143630a46b6c9ee6af">zoom_value</a>,</div><div class="line">                                    <a class="code" href="ax__ptz__movement__handler_8h.html#a28777972e354c28515d4fe8b944183f7aad2b21bd7f932ccf89decdc7f3f59535">AX_PTZ_MOVEMENT_ZOOM_UNITLESS</a>))) {</div><div class="line">      <span class="keywordflow">goto</span> failure;</div><div class="line">    }</div><div class="line"></div><div class="line">    LOGINFO(<span class="stringliteral">&quot;Absolute movement to centre tilt position.\n&quot;</span>);</div><div class="line"></div><div class="line">    <span class="comment">/* We wait for the camera ptz movement to finish */</span></div><div class="line">    <span class="keywordflow">if</span> (!(wait_for_camera_movement_to_finish())) {</div><div class="line">      <span class="keywordflow">goto</span> failure;</div><div class="line">    }</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">/* Verify that the &#39;absolute zoom movement&#39; capability is supported */</span></div><div class="line">  <span class="keywordflow">if</span> ((is_capability_supported(<span class="stringliteral">&quot;AX_PTZ_MOVE_ABS_ZOOM&quot;</span>))) {</div><div class="line">    <span class="keywordflow">if</span> (!(move_to_absolute_position(AX_PTZ_MOVEMENT_NO_VALUE,</div><div class="line">                                    AX_PTZ_MOVEMENT_NO_VALUE,</div><div class="line">                                    <a class="code" href="ax__ptz__movement__handler_8h.html#acdb1f9542dd4406117dc2b1991605debaf4593175d0426d8582f543891c300c79">AX_PTZ_MOVEMENT_PAN_TILT_UNITLESS</a>,</div><div class="line">                                    0.5f,</div><div class="line">                                    <a class="code" href="ax__ptz__movement__handler_8h.html#ac1f5dce620a163b9ef64bed56eeaae25ac45c5415ba5f653faed82474daf6cf12">AX_PTZ_MOVEMENT_PAN_TILT_SPEED_UNITLESS</a>,</div><div class="line">                                    unitless_limits-&gt;<a class="code" href="structAXPTZLimits.html#a30be40c97f0190b4185f05833aab5d1b">max_zoom_value</a>,</div><div class="line">                                    <a class="code" href="ax__ptz__movement__handler_8h.html#a28777972e354c28515d4fe8b944183f7aad2b21bd7f932ccf89decdc7f3f59535">AX_PTZ_MOVEMENT_ZOOM_UNITLESS</a>))) {</div><div class="line">      <span class="keywordflow">goto</span> failure;</div><div class="line">    }</div><div class="line"></div><div class="line">    LOGINFO(<span class="stringliteral">&quot;Absolute movement to maximum zoom position.\n&quot;</span>);</div><div class="line"></div><div class="line">    <span class="comment">/* We wait for the camera ptz movement to finish */</span></div><div class="line">    <span class="keywordflow">if</span> (!(wait_for_camera_movement_to_finish())) {</div><div class="line">      <span class="keywordflow">goto</span> failure;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (!(move_to_absolute_position(AX_PTZ_MOVEMENT_NO_VALUE,</div><div class="line">                                    AX_PTZ_MOVEMENT_NO_VALUE,</div><div class="line">                                    <a class="code" href="ax__ptz__movement__handler_8h.html#acdb1f9542dd4406117dc2b1991605debaf4593175d0426d8582f543891c300c79">AX_PTZ_MOVEMENT_PAN_TILT_UNITLESS</a>,</div><div class="line">                                    0.5f,</div><div class="line">                                    <a class="code" href="ax__ptz__movement__handler_8h.html#ac1f5dce620a163b9ef64bed56eeaae25ac45c5415ba5f653faed82474daf6cf12">AX_PTZ_MOVEMENT_PAN_TILT_SPEED_UNITLESS</a>,</div><div class="line">                                    unitless_limits-&gt;<a class="code" href="structAXPTZLimits.html#a8941f2b31e9642ab5e41b247ead25503">min_zoom_value</a>,</div><div class="line">                                    <a class="code" href="ax__ptz__movement__handler_8h.html#a28777972e354c28515d4fe8b944183f7aad2b21bd7f932ccf89decdc7f3f59535">AX_PTZ_MOVEMENT_ZOOM_UNITLESS</a>))) {</div><div class="line">      <span class="keywordflow">goto</span> failure;</div><div class="line">    }</div><div class="line"></div><div class="line">    LOGINFO(<span class="stringliteral">&quot;Absolute movement to minimum zoom position.\n&quot;</span>);</div><div class="line"></div><div class="line">    <span class="comment">/* We wait for the camera ptz movement to finish */</span></div><div class="line">    <span class="keywordflow">if</span> (!(wait_for_camera_movement_to_finish())) {</div><div class="line">      <span class="keywordflow">goto</span> failure;</div><div class="line">    }</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">/* Verify that the &#39;continous pan movement&#39; capability is supported */</span></div><div class="line">  <span class="keywordflow">if</span> ((is_capability_supported(<span class="stringliteral">&quot;AX_PTZ_MOVE_CONT_PAN&quot;</span>))) {</div><div class="line">    <span class="keywordflow">if</span> (!(start_continous_movement(unitless_pos_speed,</div><div class="line">                                   fx_zero,</div><div class="line">                                   <a class="code" href="ax__ptz__movement__handler_8h.html#ac1f5dce620a163b9ef64bed56eeaae25ac45c5415ba5f653faed82474daf6cf12">AX_PTZ_MOVEMENT_PAN_TILT_SPEED_UNITLESS</a>,</div><div class="line">                                   fx_zero, 1000.0f))) {</div><div class="line">      <span class="keywordflow">goto</span> failure;</div><div class="line">    }</div><div class="line"></div><div class="line">    LOGINFO(<span class="stringliteral">&quot;Continous pan movement started.\n&quot;</span>);</div><div class="line"></div><div class="line">    <span class="comment">/* Let the camera move for some seconds */</span></div><div class="line">    sleep(5);</div><div class="line"></div><div class="line">    <span class="comment">/* Check if camera is moving */</span></div><div class="line">    <span class="keywordflow">if</span> (!(<a class="code" href="ax__ptz__movement__handler_8h.html#af5259e3586d5358f4991bf3952f582e8">ax_ptz_movement_handler_is_ptz_moving</a></div><div class="line">         (video_channel, &amp;camera_is_moving, &amp;local_error))) {</div><div class="line">      <span class="keywordflow">goto</span> failure;</div><div class="line">    } <span class="keywordflow">else</span> {</div><div class="line">      <span class="keywordflow">if</span> (camera_is_moving) {</div><div class="line">        LOGINFO(<span class="stringliteral">&quot;Continous pan: Camera is moving.\n&quot;</span>);</div><div class="line">      } <span class="keywordflow">else</span> {</div><div class="line">        LOGINFO(<span class="stringliteral">&quot;Continous pan: Camera is not moving.\n&quot;</span>);</div><div class="line">      }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">/* Stop the continous pan movement */</span></div><div class="line">    <span class="keywordflow">if</span> (!(stop_continous_movement(TRUE, FALSE))) {</div><div class="line">      <span class="keywordflow">goto</span> failure;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">/* Give the camera some time to stop moving */</span></div><div class="line">    sleep(1);</div><div class="line"></div><div class="line">    <span class="comment">/* Check if camera is moving */</span></div><div class="line">    <span class="keywordflow">if</span> (!(<a class="code" href="ax__ptz__movement__handler_8h.html#af5259e3586d5358f4991bf3952f582e8">ax_ptz_movement_handler_is_ptz_moving</a></div><div class="line">         (video_channel, &amp;camera_is_moving, &amp;local_error))) {</div><div class="line">      <span class="keywordflow">goto</span> failure;</div><div class="line">    } <span class="keywordflow">else</span> {</div><div class="line">      <span class="keywordflow">if</span> (camera_is_moving) {</div><div class="line">        LOGINFO(<span class="stringliteral">&quot;Continous pan: Camera is moving.\n&quot;</span>);</div><div class="line">      } <span class="keywordflow">else</span> {</div><div class="line">        LOGINFO(<span class="stringliteral">&quot;Continous pan: Camera is not moving.\n&quot;</span>);</div><div class="line">      }</div><div class="line">    }</div><div class="line"></div><div class="line">    LOGINFO(<span class="stringliteral">&quot;Continous pan movement ended.\n&quot;</span>);</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">/* Create PTZ preset 0 */</span></div><div class="line">  <span class="keywordflow">if</span> (!(<a name="a40"></a><a class="code" href="ax__ptz__preset__handler_8h.html#aae3ae50dc4f329aa6bb288f586c4325b">ax_ptz_preset_handler_create_preset_name</a>(ax_ptz_control_queue_group,</div><div class="line">                                                 video_channel, <span class="stringliteral">&quot;Max_values&quot;</span>,</div><div class="line">                                                 &amp;preset_number_0,</div><div class="line">                                                 &amp;local_error))) {</div><div class="line">    <span class="keywordflow">goto</span> failure;</div><div class="line">  }</div><div class="line"></div><div class="line">  LOGINFO(<span class="stringliteral">&quot;Create preset %d\n&quot;</span>, preset_number_0);</div><div class="line"></div><div class="line">  <span class="comment">/* Verify that the &#39;absolute pan&#39;, &#39;absolute tilt&#39; and &#39;absolute zoom&#39;</span></div><div class="line"><span class="comment">   * movements are supported */</span></div><div class="line">  <span class="keywordflow">if</span> ((is_capability_supported(<span class="stringliteral">&quot;AX_PTZ_MOVE_ABS_PAN&quot;</span>) &amp;&amp;</div><div class="line">       is_capability_supported(<span class="stringliteral">&quot;AX_PTZ_MOVE_ABS_TILT&quot;</span>)</div><div class="line">       &amp;&amp; is_capability_supported(<span class="stringliteral">&quot;AX_PTZ_MOVE_ABS_ZOOM&quot;</span>))) {</div><div class="line"></div><div class="line">    <span class="comment">/* Perform unitless absolute movement to the maximum pan, tilt and zoom</span></div><div class="line"><span class="comment">     * positions */</span></div><div class="line">    <span class="keywordflow">if</span> (!(move_to_absolute_position(unitless_limits-&gt;<a class="code" href="structAXPTZLimits.html#af9fdf870bbb2dbfbf6ab7835f476573e">max_pan_value</a>,</div><div class="line">                                    unitless_limits-&gt;<a class="code" href="structAXPTZLimits.html#a655a7bce0af4f3374ea879bc3ad03539">max_tilt_value</a>,</div><div class="line">                                    <a class="code" href="ax__ptz__movement__handler_8h.html#acdb1f9542dd4406117dc2b1991605debaf4593175d0426d8582f543891c300c79">AX_PTZ_MOVEMENT_PAN_TILT_UNITLESS</a>,</div><div class="line">                                    0.5f,</div><div class="line">                                    <a class="code" href="ax__ptz__movement__handler_8h.html#ac1f5dce620a163b9ef64bed56eeaae25ac45c5415ba5f653faed82474daf6cf12">AX_PTZ_MOVEMENT_PAN_TILT_SPEED_UNITLESS</a>,</div><div class="line">                                    unitless_limits-&gt;<a class="code" href="structAXPTZLimits.html#a30be40c97f0190b4185f05833aab5d1b">max_zoom_value</a>,</div><div class="line">                                    <a class="code" href="ax__ptz__movement__handler_8h.html#a28777972e354c28515d4fe8b944183f7aad2b21bd7f932ccf89decdc7f3f59535">AX_PTZ_MOVEMENT_ZOOM_UNITLESS</a>))) {</div><div class="line">      <span class="keywordflow">goto</span> failure;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">/* We wait for the camera ptz movement to finish */</span></div><div class="line">    <span class="keywordflow">if</span> (!(wait_for_camera_movement_to_finish())) {</div><div class="line">      <span class="keywordflow">goto</span> failure;</div><div class="line">    }</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">/* Set PTZ preset 0 to the current camera position */</span></div><div class="line">  <span class="keywordflow">if</span> (!(<a name="a41"></a><a class="code" href="ax__ptz__preset__handler_8h.html#af8e0bbcb68457c8631ac37ab2aacc6cb">ax_ptz_preset_handler_set_preset_number</a>(ax_ptz_control_queue_group,</div><div class="line">                                                video_channel, preset_number_0,</div><div class="line">                                                FALSE, &amp;local_error))) {</div><div class="line">    <span class="keywordflow">goto</span> failure;</div><div class="line">  }</div><div class="line">  LOGINFO(<span class="stringliteral">&quot;Set preset %d\n&quot;</span>, preset_number_0);</div><div class="line"></div><div class="line">  <span class="comment">/* Create PTZ preset 1 */</span></div><div class="line">  <span class="keywordflow">if</span> (!(<a class="code" href="ax__ptz__preset__handler_8h.html#aae3ae50dc4f329aa6bb288f586c4325b">ax_ptz_preset_handler_create_preset_name</a>(ax_ptz_control_queue_group,</div><div class="line">                                                 video_channel, <span class="stringliteral">&quot;Centre_values&quot;</span>,</div><div class="line">                                                 &amp;preset_number_1,</div><div class="line">                                                 &amp;local_error))) {</div><div class="line">    <span class="keywordflow">goto</span> failure;</div><div class="line">  }</div><div class="line"></div><div class="line">  LOGINFO(<span class="stringliteral">&quot;Create preset %d\n&quot;</span>, preset_number_1);</div><div class="line"></div><div class="line">  <span class="comment">/* Verify that the &#39;absolute pan&#39;, &#39;absolute tilt&#39; and &#39;absolute zoom&#39;</span></div><div class="line"><span class="comment">   * movements are supported */</span></div><div class="line">  <span class="keywordflow">if</span> ((is_capability_supported(<span class="stringliteral">&quot;AX_PTZ_MOVE_ABS_PAN&quot;</span>) &amp;&amp;</div><div class="line">       is_capability_supported(<span class="stringliteral">&quot;AX_PTZ_MOVE_ABS_TILT&quot;</span>)</div><div class="line">       &amp;&amp; is_capability_supported(<span class="stringliteral">&quot;AX_PTZ_MOVE_ABS_ZOOM&quot;</span>))) {</div><div class="line"></div><div class="line">    <span class="comment">/* Perform unitless absolute movement to the centre pan, tilt and zoom</span></div><div class="line"><span class="comment">     * positions */</span></div><div class="line">    <span class="keywordflow">if</span> (!(move_to_absolute_position(unitless_centre_pan,</div><div class="line">                                    unitless_centre_tilt,</div><div class="line">                                    <a class="code" href="ax__ptz__movement__handler_8h.html#acdb1f9542dd4406117dc2b1991605debaf4593175d0426d8582f543891c300c79">AX_PTZ_MOVEMENT_PAN_TILT_UNITLESS</a>,</div><div class="line">                                    0.5f,</div><div class="line">                                    <a class="code" href="ax__ptz__movement__handler_8h.html#ac1f5dce620a163b9ef64bed56eeaae25ac45c5415ba5f653faed82474daf6cf12">AX_PTZ_MOVEMENT_PAN_TILT_SPEED_UNITLESS</a>,</div><div class="line">                                    unitless_centre_zoom,</div><div class="line">                                    <a class="code" href="ax__ptz__movement__handler_8h.html#a28777972e354c28515d4fe8b944183f7aad2b21bd7f932ccf89decdc7f3f59535">AX_PTZ_MOVEMENT_ZOOM_UNITLESS</a>))) {</div><div class="line">      <span class="keywordflow">goto</span> failure;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">/* We wait for the camera ptz movement to finish */</span></div><div class="line">    <span class="keywordflow">if</span> (!(wait_for_camera_movement_to_finish())) {</div><div class="line">      <span class="keywordflow">goto</span> failure;</div><div class="line">    }</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">/* Set PTZ preset 1 to the current camera position */</span></div><div class="line">  <span class="keywordflow">if</span> (!(<a class="code" href="ax__ptz__preset__handler_8h.html#af8e0bbcb68457c8631ac37ab2aacc6cb">ax_ptz_preset_handler_set_preset_number</a>(ax_ptz_control_queue_group,</div><div class="line">                                                video_channel, preset_number_1,</div><div class="line">                                                FALSE, &amp;local_error))) {</div><div class="line">    <span class="keywordflow">goto</span> failure;</div><div class="line">  }</div><div class="line"></div><div class="line">  LOGINFO(<span class="stringliteral">&quot;Set preset %d\n&quot;</span>, preset_number_1);</div><div class="line"></div><div class="line">  <span class="comment">/* Goto preset 0 */</span></div><div class="line">  <span class="keywordflow">if</span> (!(<a name="a42"></a><a class="code" href="ax__ptz__preset__handler_8h.html#a2a59bfec9c2f7dd6d4a448f167ff309f">ax_ptz_preset_handler_goto_preset_number</a>(ax_ptz_control_queue_group,</div><div class="line">                                                 video_channel,</div><div class="line">                                                 preset_number_0,</div><div class="line">                                                 fx_ftox(1.0f,</div><div class="line">                                                         FIXMATH_FRAC_BITS),</div><div class="line">                                                 <a name="a43"></a><a class="code" href="ax__ptz__preset__handler_8h.html#a050943d304947e464ada4c8133f54945a7f1aaee14394558935dd4485ea5bf0fe">AX_PTZ_PRESET_MOVEMENT_UNITLESS</a>,</div><div class="line">                                                 <a class="code" href="ax__ptz__types_8h.html#a369cd74684ba8a67304ff2f05d8456dcaa1883c21d55bbcf3b69030005566b2d7">AX_PTZ_INVOKE_ASYNC</a>, NULL,</div><div class="line">                                                 NULL, &amp;local_error))) {</div><div class="line">    <span class="keywordflow">goto</span> failure;</div><div class="line">  }</div><div class="line"></div><div class="line">  LOGINFO(<span class="stringliteral">&quot;Goto preset %d\n&quot;</span>, preset_number_0);</div><div class="line"></div><div class="line">  <span class="comment">/* We wait for the camera ptz movement to finish */</span></div><div class="line">  <span class="keywordflow">if</span> (!(wait_for_camera_movement_to_finish())) {</div><div class="line">    <span class="keywordflow">goto</span> failure;</div><div class="line">  }</div><div class="line"></div><div class="line">  sleep(2);</div><div class="line"></div><div class="line">  <span class="comment">/* Goto preset 1 */</span></div><div class="line">  <span class="keywordflow">if</span> (!(<a class="code" href="ax__ptz__preset__handler_8h.html#a2a59bfec9c2f7dd6d4a448f167ff309f">ax_ptz_preset_handler_goto_preset_number</a>(ax_ptz_control_queue_group,</div><div class="line">                                                 video_channel,</div><div class="line">                                                 preset_number_1,</div><div class="line">                                                 fx_ftox(1.0f,</div><div class="line">                                                         FIXMATH_FRAC_BITS),</div><div class="line">                                                 <a class="code" href="ax__ptz__preset__handler_8h.html#a050943d304947e464ada4c8133f54945a7f1aaee14394558935dd4485ea5bf0fe">AX_PTZ_PRESET_MOVEMENT_UNITLESS</a>,</div><div class="line">                                                 <a class="code" href="ax__ptz__types_8h.html#a369cd74684ba8a67304ff2f05d8456dcaa1883c21d55bbcf3b69030005566b2d7">AX_PTZ_INVOKE_ASYNC</a>, NULL,</div><div class="line">                                                 NULL, &amp;local_error))) {</div><div class="line">    <span class="keywordflow">goto</span> failure;</div><div class="line">  }</div><div class="line"></div><div class="line">  LOGINFO(<span class="stringliteral">&quot;Goto preset %d\n&quot;</span>, preset_number_1);</div><div class="line"></div><div class="line">  <span class="comment">/* We wait for the camera ptz movement to finish */</span></div><div class="line">  <span class="keywordflow">if</span> (!(wait_for_camera_movement_to_finish())) {</div><div class="line">    <span class="keywordflow">goto</span> failure;</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">/* Remove preset 0 */</span></div><div class="line">  <span class="keywordflow">if</span> (!(<a name="a44"></a><a class="code" href="ax__ptz__preset__handler_8h.html#aea30b550027f8722b92c9f4a3b85e359">ax_ptz_preset_handler_remove_preset_number</a>(ax_ptz_control_queue_group,</div><div class="line">                                                   video_channel,</div><div class="line">                                                   preset_number_0,</div><div class="line">                                                   &amp;local_error))) {</div><div class="line">    <span class="keywordflow">goto</span> failure;</div><div class="line">  }</div><div class="line"></div><div class="line">  LOGINFO(<span class="stringliteral">&quot;Remove preset %d\n&quot;</span>, preset_number_0);</div><div class="line"></div><div class="line">  <span class="comment">/* Remove preset 1 */</span></div><div class="line">  <span class="keywordflow">if</span> (!(<a class="code" href="ax__ptz__preset__handler_8h.html#aea30b550027f8722b92c9f4a3b85e359">ax_ptz_preset_handler_remove_preset_number</a>(ax_ptz_control_queue_group,</div><div class="line">                                                   video_channel,</div><div class="line">                                                   preset_number_1,</div><div class="line">                                                   &amp;local_error))) {</div><div class="line">    <span class="keywordflow">goto</span> failure;</div><div class="line">  }</div><div class="line"></div><div class="line">  LOGINFO(<span class="stringliteral">&quot;Remove preset %d\n&quot;</span>, preset_number_1);</div><div class="line"></div><div class="line">  <span class="comment">/* Get the PTZ control queue status for the application */</span></div><div class="line">  <span class="keywordflow">if</span> (!(<a name="a45"></a><a class="code" href="ax__ptz__control__queue_8h.html#adf18020a0b42f43f5d9aec85070bf708">ax_ptz_control_queue_request</a>(ax_ptz_control_queue_group,</div><div class="line">                                     video_channel,</div><div class="line">                                     <a name="a46"></a><a class="code" href="ax__ptz__control__queue_8h.html#a13fa68ed37fa6b4f8eaad73a9d560c00a8e9a1847761a05e5559adad94408b0ad">AX_PTZ_CONTROL_QUEUE_QUERY_STATUS</a>,</div><div class="line">                                     &amp;queue_pos, &amp;time_to_pos_one, &amp;poll_time,</div><div class="line">                                     &amp;local_error))) {</div><div class="line">    <span class="keywordflow">goto</span> failure;</div><div class="line">  }</div><div class="line"></div><div class="line">  LOGINFO(<span class="stringliteral">&quot;Request AX_PTZ_CONTROL_QUEUE_QUERY_STATUS:\n&quot;</span>);</div><div class="line">  LOGINFO(<span class="stringliteral">&quot;queue_pos = %d\n&quot;</span>, queue_pos);</div><div class="line">  LOGINFO(<span class="stringliteral">&quot;time_to_pos_one = %d\n&quot;</span>, time_to_pos_one);</div><div class="line">  LOGINFO(<span class="stringliteral">&quot;poll_time = %d\n&quot;</span>, poll_time);</div><div class="line"></div><div class="line">  <span class="comment">/* Request for getting the PTZ control */</span></div><div class="line">  <span class="keywordflow">if</span> (!(<a class="code" href="ax__ptz__control__queue_8h.html#adf18020a0b42f43f5d9aec85070bf708">ax_ptz_control_queue_request</a>(ax_ptz_control_queue_group,</div><div class="line">                                     video_channel,</div><div class="line">                                     <a name="a47"></a><a class="code" href="ax__ptz__control__queue_8h.html#a13fa68ed37fa6b4f8eaad73a9d560c00a0523b5aac4319ea94dd2caaf9a06d8b7">AX_PTZ_CONTROL_QUEUE_GET</a>,</div><div class="line">                                     &amp;queue_pos, &amp;time_to_pos_one, &amp;poll_time,</div><div class="line">                                     &amp;local_error))) {</div><div class="line">    <span class="keywordflow">goto</span> failure;</div><div class="line">  }</div><div class="line"></div><div class="line">  LOGINFO(<span class="stringliteral">&quot;Request AX_PTZ_CONTROL_QUEUE_GET:\n&quot;</span>);</div><div class="line">  LOGINFO(<span class="stringliteral">&quot;queue_pos = %d\n&quot;</span>, queue_pos);</div><div class="line">  LOGINFO(<span class="stringliteral">&quot;time_to_pos_one = %d\n&quot;</span>, time_to_pos_one);</div><div class="line">  LOGINFO(<span class="stringliteral">&quot;poll_time = %d\n&quot;</span>, poll_time);</div><div class="line"></div><div class="line">  <span class="comment">/* Get the PTZ control queue status for the application */</span></div><div class="line">  <span class="keywordflow">if</span> (!(<a class="code" href="ax__ptz__control__queue_8h.html#adf18020a0b42f43f5d9aec85070bf708">ax_ptz_control_queue_request</a>(ax_ptz_control_queue_group,</div><div class="line">                                     video_channel,</div><div class="line">                                     <a class="code" href="ax__ptz__control__queue_8h.html#a13fa68ed37fa6b4f8eaad73a9d560c00a8e9a1847761a05e5559adad94408b0ad">AX_PTZ_CONTROL_QUEUE_QUERY_STATUS</a>,</div><div class="line">                                     &amp;queue_pos, &amp;time_to_pos_one, &amp;poll_time,</div><div class="line">                                     &amp;local_error))) {</div><div class="line">    <span class="keywordflow">goto</span> failure;</div><div class="line">  }</div><div class="line"></div><div class="line">  LOGINFO(<span class="stringliteral">&quot;Request AX_PTZ_CONTROL_QUEUE_QUERY_STATUS:\n&quot;</span>);</div><div class="line">  LOGINFO(<span class="stringliteral">&quot;queue_pos = %d\n&quot;</span>, queue_pos);</div><div class="line">  LOGINFO(<span class="stringliteral">&quot;time_to_pos_one = %d\n&quot;</span>, time_to_pos_one);</div><div class="line">  LOGINFO(<span class="stringliteral">&quot;poll_time = %d\n&quot;</span>, poll_time);</div><div class="line"></div><div class="line">  <span class="comment">/* Request for dropping the PTZ control */</span></div><div class="line">  <span class="keywordflow">if</span> (!(<a class="code" href="ax__ptz__control__queue_8h.html#adf18020a0b42f43f5d9aec85070bf708">ax_ptz_control_queue_request</a>(ax_ptz_control_queue_group,</div><div class="line">                                     video_channel,</div><div class="line">                                     <a name="a48"></a><a class="code" href="ax__ptz__control__queue_8h.html#a13fa68ed37fa6b4f8eaad73a9d560c00a285e2aeec7503581ec6bcb16dbcf572d">AX_PTZ_CONTROL_QUEUE_DROP</a>,</div><div class="line">                                     &amp;queue_pos, &amp;time_to_pos_one, &amp;poll_time,</div><div class="line">                                     &amp;local_error))) {</div><div class="line">    <span class="keywordflow">goto</span> failure;</div><div class="line">  }</div><div class="line"></div><div class="line">  LOGINFO(<span class="stringliteral">&quot;Request AX_PTZ_CONTROL_QUEUE_DROP:\n&quot;</span>);</div><div class="line">  LOGINFO(<span class="stringliteral">&quot;queue_pos = %d\n&quot;</span>, queue_pos);</div><div class="line">  LOGINFO(<span class="stringliteral">&quot;time_to_pos_one = %d\n&quot;</span>, time_to_pos_one);</div><div class="line">  LOGINFO(<span class="stringliteral">&quot;poll_time = %d\n&quot;</span>, poll_time);</div><div class="line"></div><div class="line">  <span class="comment">/* Get the PTZ control queue status for the application */</span></div><div class="line">  <span class="keywordflow">if</span> (!(<a class="code" href="ax__ptz__control__queue_8h.html#adf18020a0b42f43f5d9aec85070bf708">ax_ptz_control_queue_request</a>(ax_ptz_control_queue_group,</div><div class="line">                                     video_channel,</div><div class="line">                                     <a class="code" href="ax__ptz__control__queue_8h.html#a13fa68ed37fa6b4f8eaad73a9d560c00a8e9a1847761a05e5559adad94408b0ad">AX_PTZ_CONTROL_QUEUE_QUERY_STATUS</a>,</div><div class="line">                                     &amp;queue_pos, &amp;time_to_pos_one, &amp;poll_time,</div><div class="line">                                     &amp;local_error))) {</div><div class="line">    <span class="keywordflow">goto</span> failure;</div><div class="line">  }</div><div class="line"></div><div class="line">  LOGINFO(<span class="stringliteral">&quot;Request AX_PTZ_CONTROL_QUEUE_QUERY_STATUS:\n&quot;</span>);</div><div class="line">  LOGINFO(<span class="stringliteral">&quot;queue_pos = %d\n&quot;</span>, queue_pos);</div><div class="line">  LOGINFO(<span class="stringliteral">&quot;time_to_pos_one = %d\n&quot;</span>, time_to_pos_one);</div><div class="line">  LOGINFO(<span class="stringliteral">&quot;poll_time = %d\n&quot;</span>, poll_time);</div><div class="line"></div><div class="line">  <span class="comment">/* Now we don&#39;t need the axptz library anymore, destroy it */</span></div><div class="line">  <span class="keywordflow">if</span> (!(<a name="a49"></a><a class="code" href="ax__ptz_8h.html#a840f6d7b386bae8e6af06c22b6314171">ax_ptz_destroy</a>(&amp;local_error))) {</div><div class="line">    <span class="keywordflow">goto</span> failure;</div><div class="line">  }</div><div class="line"></div><div class="line">  LOGINFO(<span class="stringliteral">&quot;%s finished successfully...\n&quot;</span>, APP_NAME);</div><div class="line"></div><div class="line">  <span class="comment">/* Perform cleanup */</span></div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (local_error) {</div><div class="line">    g_error_free(local_error);</div><div class="line">    local_error = NULL;</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (capabilities) {</div><div class="line">    <span class="keywordflow">for</span> (it = g_list_first(capabilities); it != NULL; it = g_list_next(it)) {</div><div class="line">      g_free((gchar *) it-&gt;data);</div><div class="line">    }</div><div class="line">  }</div><div class="line"></div><div class="line">  g_list_free(capabilities);</div><div class="line">  capabilities = NULL;</div><div class="line">  g_free(unitless_status);</div><div class="line">  unitless_status = NULL;</div><div class="line">  g_free(unitless_limits);</div><div class="line">  unitless_limits = NULL;</div><div class="line">  g_free(unit_limits);</div><div class="line">  unit_limits = NULL;</div><div class="line"></div><div class="line">  exit(EXIT_SUCCESS);</div><div class="line"></div><div class="line"><span class="comment">/* We will end up here if something went wrong */</span></div><div class="line"> failure:</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (local_error &amp;&amp; local_error-&gt;message) {</div><div class="line">    LOGINFO(<span class="stringliteral">&quot;ERROR: %s ended with errors:\n&quot;</span>, APP_NAME);</div><div class="line">    LOGINFO(<span class="stringliteral">&quot;%s\n&quot;</span>, local_error-&gt;message);</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (local_error) {</div><div class="line">    g_error_free(local_error);</div><div class="line">    local_error = NULL;</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">/* Now we don&#39;t need the axptz library anymore, destroy it */</span></div><div class="line">  <a class="code" href="ax__ptz_8h.html#a840f6d7b386bae8e6af06c22b6314171">ax_ptz_destroy</a>(&amp;local_error);</div><div class="line"></div><div class="line">  <span class="comment">/* Perform cleanup */</span></div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (local_error) {</div><div class="line">    g_error_free(local_error);</div><div class="line">    local_error = NULL;</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (capabilities) {</div><div class="line">    <span class="keywordflow">for</span> (it = g_list_first(capabilities); it != NULL; it = g_list_next(it)) {</div><div class="line">      g_free((gchar *) it-&gt;data);</div><div class="line">    }</div><div class="line">  }</div><div class="line"></div><div class="line">  g_list_free(capabilities);</div><div class="line">  capabilities = NULL;</div><div class="line">  g_free(unitless_status);</div><div class="line">  unitless_status = NULL;</div><div class="line">  g_free(unitless_limits);</div><div class="line">  unitless_limits = NULL;</div><div class="line">  g_free(unit_limits);</div><div class="line">  unit_limits = NULL;</div><div class="line"></div><div class="line"><span class="preprocessor">#ifdef WRITE_TO_SYS_LOG</span></div><div class="line">  closelog();</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line">  exit(EXIT_FAILURE);</div><div class="line">}</div></div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Copyright &copy; 2009-2021 Axis Communications AB. All rights reserved.</li>
  </ul>
</div>
</body>
</html>
